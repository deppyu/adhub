select main menu mnu_ad_owner
select main menu mnu_admin
select main menu mnu_agent
select main menu mnu_agent
select main menu mnu_my_account
select main menu mnu_my_company
select main menu mnu_my_company
select main menu mnu_publisher
  [1m[36mSQL (0.4ms)[0m  [1mdescribe `ad_containers_content_categories`[0m
  [1m[35mSQL (0.5ms)[0m  describe `ad_containers_publish_policies`
  [1m[36mSQL (0.5ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (0.4ms)[0m  describe `ad_containers_content_categories`
  [1m[36mSQL (0.4ms)[0m  [1mdescribe `members_roles`[0m
  [1m[35mSQL (0.4ms)[0m  describe `content_categories_publish_policies`
  [1m[36mSQL (0.3ms)[0m  [1mdescribe `ad_containers_publish_policies`[0m
Unable to load ad_containers_publish_policy, underlying cause No such file to load -- ad_containers_publish_policy 

 /var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:304:in `depend_on'
/var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:216:in `require_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:868:in `try_to_load_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:883:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `each'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:863:in `fixtures'
./test/test_helper.rb:10
./test/functional/publisher/reports_controller_test.rb:1:in `require'
./test/functional/publisher/reports_controller_test.rb:1
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load content_categories_publish_policy, underlying cause No such file to load -- content_categories_publish_policy 

 /var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:304:in `depend_on'
/var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:216:in `require_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:868:in `try_to_load_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:883:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `each'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:863:in `fixtures'
./test/test_helper.rb:10
./test/functional/publisher/reports_controller_test.rb:1:in `require'
./test/functional/publisher/reports_controller_test.rb:1
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load members_role, underlying cause No such file to load -- members_role 

 /var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:304:in `depend_on'
/var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:216:in `require_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:868:in `try_to_load_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:883:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `each'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:863:in `fixtures'
./test/test_helper.rb:10
./test/functional/publisher/reports_controller_test.rb:1:in `require'
./test/functional/publisher/reports_controller_test.rb:1
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_1') LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  describe `parties`
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:09', 'Party_1\'s address', 0, '2012-03-13 09:36:09', 'Party_1', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (57.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  describe `channels`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:09', '2012-03-13 09:36:09', 'Channe_1', 'Channe_1')[0m
  [1m[35mSQL (42.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 6 AND (`ad_containers`.`name` = BINARY 'AdContainer_1') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'RUSUMzh22nSEtl45KWgR'[0m
  [1m[35mSQL (0.4ms)[0m  describe `ad_containers`
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `description`, `name`, `request_count`, `status`, `updated_at`, `show_count`, `os_type`, `created_at`, `income`, `latitude`, `channel_id`, `type`, `click_count`, `party_id`, `longitude`) VALUES ('http://www.adhub.com/AdContainer_1', 'RUSUMzh22nSEtl45KWgR', 'desc', 'AdContainer_1', 0, 1, '2012-03-13 09:36:09', 0, 0, '2012-03-13 09:36:09', 0.0, NULL, 417882963, 'Application', 0, 6, NULL)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 6) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (29.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:09', 'Party_2\'s address', 0, '2012-03-13 09:36:09', 'Party_2', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (37.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mdescribe `pay_methods`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:09', '2012-03-13 09:36:09', 1000, 'pm_1', 0)
  [1m[36mSQL (28.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_3') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:09', 'Party_3\'s address', 0, '2012-03-13 09:36:09', 'Party_3', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (28.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mdescribe `campaigns`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:09', 'Campaign_1', '2012-04-13', '2012-03-13 09:36:09', '2012-03-13', 0.0, 8, 1000.0, 'desc')
  [1m[36mSQL (38.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.5ms)[0m  [1mdescribe `advertisements`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('Ad_1', 'http://www.ad.com/Ad_1', 'icon_text', 0, '2012-03-13 09:36:09', 1, 0, 8, '2012-03-13 09:36:09', 2, 0, 0)
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.5ms)[0m  [1mdescribe `publish_policies`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_1', '2012-03-13 09:36:09', 10.0, 3, 100.0, 1, 0.0, '2012-03-13', 417882963, 5, '2012-04-13', 3, 1, NULL, 'url', '2012-03-13 09:36:09')
  [1m[36mSQL (41.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `publish_policies` SET `updated_at` = '2012-03-13 09:36:09', `status` = 3, `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 3[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 3 )
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 3 )[0m
  [1m[35mAdShowControl Load (0.2ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 3) LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mdescribe `ad_show_controls`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_show_controls` (`campaign_id`, `publish_policy_id`, `advertisement_id`, `created_at`, `content_categories`, `channel_id`, `unit_price`, `updated_at`, `end`, `weight`, `begin`, `ad_format`, `ad_containers`, `party_id`, `size_codes`) VALUES (3, 3, 5, '2012-03-13 09:36:09', NULL, 417882963, 0.01, '2012-03-13 09:36:09', '2012-04-13', 1.0, '2012-03-13', 'icon_text', NULL, 8, NULL)
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.6ms)[0m  [1mdescribe `contracts`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:09', '2012-03-13 09:36:09', '2013-03-13', 0.8, 6, '123456', 0, 'person', 0.9)
  [1m[36mSQL (49.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_4') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:09', 'Party_4\'s address', 0, '2012-03-13 09:36:09', 'Party_4', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_1 @abc.com') LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  describe `members`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:09', 0, 9, 1, 'member_1 @abc.com', 'f6b0a2fec25949ce2ad400e179b6aad8', 'member_1 ', '2012-03-13 09:36:09')[0m
  [1m[35mSQL (42.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  describe `ad_resources`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('icon', NULL, 80, 'image/jpeg', 'icon_text_icon.jpg', '2012-03-13 09:36:09', '2012-03-13 09:36:09', 80, 7, 5, 'square', 'icon_text')[0m
  [1m[35mSQL (57.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_5') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:09', 'Party_5\'s address', 0, '2012-03-13 09:36:09', 'Party_5', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (42.7ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_2 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:10', 0, 10, 1, 'member_2 @abc.com', '3f34e6fc4eb5b412495a4528ab6068b2', 'member_2 ', '2012-03-13 09:36:10')[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('title', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:10', '2012-03-13 09:36:10', NULL, 8, 5, NULL, 'icon_text')
  [1m[36mSQL (45.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_6') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:10', 'Party_6\'s address', 0, '2012-03-13 09:36:10', 'Party_6', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_3 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:10', 0, 11, 1, 'member_3 @abc.com', '5a1df154d99a4aab5d10574ac72f881d', 'member_3 ', '2012-03-13 09:36:10')
  [1m[36mSQL (44.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('subtitle', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:10', '2012-03-13 09:36:10', NULL, 9, 5, NULL, 'icon_text')[0m
  [1m[35mSQL (45.8ms)[0m  COMMIT
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 8) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mdescribe `accounts`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:10', '2012-03-13 09:36:10', 0.0, 8)
  [1m[36mSQL (41.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (47.7ms)[0m  update accounts set balance = balance + 1000 where id = 3
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 3 LIMIT 1[0m
  [1m[35mSQL (46.9ms)[0m  update accounts set balance = balance + 100 where id = 3
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 3 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_7') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:10', 'Party_7\'s address', 0, '2012-03-13 09:36:10', 'Party_7', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (42.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:10', 'Campaign_2', '2012-04-13', '2012-03-13 09:36:10', '2012-03-13', 0.0, 12, 1000.0, 'desc')[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('Ad_2', 'http://www.ad.com/Ad_2', 'icon_text', 0, '2012-03-13 09:36:10', 1, 0, 12, '2012-03-13 09:36:10', 2, 0, 0)
  [1m[36mSQL (45.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:10', '2012-03-13 09:36:10', 1, 'pm_2', 1)[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_2', '2012-03-13 09:36:10', 10.0, 4, 100.0, 1, 0.0, '2012-03-13', 417882963, 6, '2012-04-13', 4, 1, NULL, 'url', '2012-03-13 09:36:10')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `publish_policies` SET `updated_at` = '2012-03-13 09:36:10', `status` = 3, `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 4[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 4 )
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 4 )[0m
  [1m[35mAdShowControl Load (0.1ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 4) LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_show_controls` (`campaign_id`, `publish_policy_id`, `advertisement_id`, `created_at`, `content_categories`, `channel_id`, `unit_price`, `updated_at`, `end`, `weight`, `begin`, `ad_format`, `ad_containers`, `party_id`, `size_codes`) VALUES (4, 4, 6, '2012-03-13 09:36:10', NULL, 417882963, 10.0, '2012-03-13 09:36:10', '2012-04-13', 1.0, '2012-03-13', 'icon_text', NULL, 12, NULL)[0m
  [1m[35mSQL (45.7ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `publish_policies` SET `updated_at` = '2012-03-13 09:36:10', `daily_budget` = 0.0, `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 4
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  Processing by AdRequestsController#index as JSON
  Parameters: {"app"=>"RUSUMzh22nSEtl45KWgR", "size"=>"banner", "device"=>"mobile_phone"}
Geokit is using the domain: test.host
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'RUSUMzh22nSEtl45KWgR' LIMIT 1
found container #<Application:0xb52a65b0>
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 6 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 6) AND (expired_at >= '2012-03-13' )
  [1m[36mAdRequest Load (0.2ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258269 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.6ms)[0m  [1mdescribe `ad_requests`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_requests` (`pay_method_id`, `shown`, `advertisement_id`, `publisher_share_rate`, `unit_price`, `ad_owner_id`, `agent_id`, `request_date`, `fulfilled`, `updated_at`, `size_code`, `ip_address`, `agent_share_rate`, `campaign_id`, `publish_policy_id`, `publisher_id`, `ad_container_id`, `clicked`, `paid`, `created_at`) VALUES (NULL, 0, NULL, NULL, NULL, NULL, NULL, '2012-03-13', 0, '2012-03-13 09:36:10', 'banner', '0.0.0.0', NULL, NULL, NULL, 6, 298258269, 0, 0, '2012-03-13 09:36:10')
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258269[0m
  [1m[35mSQL (49.0ms)[0m  COMMIT
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258269 )[0m
  [1m[35mAdShowControl Load (0.4ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882963) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258269\'%'))) ORDER BY weight * rand() desc LIMIT 1
  [1m[36mPublishPolicy Load (0.2ms)[0m  [1mSELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 3 LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`publish_policy_id` = 3 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1
  [1m[36mCampaign Load (0.2ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 3 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`campaign_id` = 3 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 8 LIMIT 1[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 8) LIMIT 1
  [1m[36mPayMethod Load (0.1ms)[0m  [1mSELECT `pay_methods`.* FROM `pay_methods` WHERE `pay_methods`.`id` = 3 LIMIT 1[0m
  [1m[35mAdvertisement Load (0.2ms)[0m  SELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 5 LIMIT 1
  [1m[36mCampaign Load (0.1ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 3 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 8 LIMIT 1
  [1m[36mContract Load (0.2ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 6) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `ad_requests` SET `pay_method_id` = 3, `advertisement_id` = 5, `publisher_share_rate` = 0.8, `unit_price` = 0.01, `ad_owner_id` = 8, `fulfilled` = 1, `updated_at` = '2012-03-13 09:36:10', `agent_share_rate` = 0.0, `campaign_id` = 3, `publish_policy_id` = 3 WHERE `ad_requests`.`id` = 980190963[0m
  [1m[35mSQL (30.6ms)[0m  COMMIT
  [1m[36mAdvertisement Load (0.1ms)[0m  [1mSELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 5 LIMIT 1[0m
advertisement = #<Advertisement:0xb51fc114>
  [1m[35mAdResource Load (0.3ms)[0m  SELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'icon' AND (`ad_resources`.advertisement_id = 5) LIMIT 1
  [1m[36mAdResource Load (0.2ms)[0m  [1mSELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'title' AND (`ad_resources`.advertisement_id = 5) LIMIT 1[0m
  [1m[35mAdResource Load (0.2ms)[0m  SELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'subtitle' AND (`ad_resources`.advertisement_id = 5) LIMIT 1
Completed 200 OK in 214ms (Views: 92.6ms | ActiveRecord: 1806.7ms)
  [1m[36mAdRequest Load (0.2ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190963 LIMIT 1[0m
  [1m[35mAdvertisement Load (0.1ms)[0m  SELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 5 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_8') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:11', 'Party_8\'s address', 0, '2012-03-13 09:36:11', 'Party_8', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (31.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:11', '2012-03-13 09:36:11', 'Channe_2', 'Channe_2')
  [1m[36mSQL (45.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 13 AND (`ad_containers`.`name` = BINARY 'AdContainer_2') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'Zv2NA1hBqYGHx5Lx2PUw'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `description`, `name`, `request_count`, `status`, `updated_at`, `show_count`, `os_type`, `created_at`, `income`, `latitude`, `channel_id`, `type`, `click_count`, `party_id`, `longitude`) VALUES ('http://www.adhub.com/AdContainer_2', 'Zv2NA1hBqYGHx5Lx2PUw', 'desc', 'AdContainer_2', 0, 1, '2012-03-13 09:36:11', 0, 0, '2012-03-13 09:36:11', 0.0, NULL, 417882964, 'Application', 0, 13, NULL)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 13) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (53.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_9') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:11', 'Party_9\'s address', 0, '2012-03-13 09:36:11', 'Party_9', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:11', '2012-03-13 09:36:11', 1000, 'pm_3', 0)[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_10') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:11', 'Party_10\'s address', 0, '2012-03-13 09:36:11', 'Party_10', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:11', 'Campaign_3', '2012-04-13', '2012-03-13 09:36:11', '2012-03-13', 0.0, 15, 1000.0, 'desc')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('Ad_3', 'http://www.ad.com/Ad_3', 'icon_text', 0, '2012-03-13 09:36:11', 1, 0, 15, '2012-03-13 09:36:11', 2, 0, 0)[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_3', '2012-03-13 09:36:11', 10.0, 5, 100.0, 1, 0.0, '2012-03-13', 417882964, 7, '2012-04-13', 5, 1, NULL, 'url', '2012-03-13 09:36:11')
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `publish_policies` SET `updated_at` = '2012-03-13 09:36:11', `status` = 3, `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 5[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882964 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882964 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 5 )
  [1m[36mAdContainer Load (0.1ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 5 )[0m
  [1m[35mAdShowControl Load (0.2ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 5) LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_show_controls` (`campaign_id`, `publish_policy_id`, `advertisement_id`, `created_at`, `content_categories`, `channel_id`, `unit_price`, `updated_at`, `end`, `weight`, `begin`, `ad_format`, `ad_containers`, `party_id`, `size_codes`) VALUES (5, 5, 7, '2012-03-13 09:36:11', NULL, 417882964, 0.01, '2012-03-13 09:36:11', '2012-04-13', 1.0, '2012-03-13', 'icon_text', NULL, 15, NULL)[0m
  [1m[35mSQL (48.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:11', '2012-03-13 09:36:11', '2013-03-13', 0.8, 13, '123456', 0, 'person', 0.9)
  [1m[36mSQL (44.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_11') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:11', 'Party_11\'s address', 0, '2012-03-13 09:36:11', 'Party_11', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_4 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:11', 0, 16, 1, 'member_4 @abc.com', 'f9e248db37b23039903fbb92fe8f62e6', 'member_4 ', '2012-03-13 09:36:11')
  [1m[36mSQL (44.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('icon', NULL, 80, 'image/jpeg', 'icon_text_icon.jpg', '2012-03-13 09:36:11', '2012-03-13 09:36:11', 80, 10, 7, 'square', 'icon_text')[0m
  [1m[35mSQL (50.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_12') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:11', 'Party_12\'s address', 0, '2012-03-13 09:36:11', 'Party_12', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (42.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_5 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:11', 0, 17, 1, 'member_5 @abc.com', 'fdb5856f381e8aba22a93660116b6054', 'member_5 ', '2012-03-13 09:36:11')[0m
  [1m[35mSQL (44.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('title', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:11', '2012-03-13 09:36:11', NULL, 11, 7, NULL, 'icon_text')
  [1m[36mSQL (45.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_13') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:11', 'Party_13\'s address', 0, '2012-03-13 09:36:11', 'Party_13', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_6 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:12', 0, 18, 1, 'member_6 @abc.com', '45342a9590a69c2eaf3f3185ac37152b', 'member_6 ', '2012-03-13 09:36:12')
  [1m[36mSQL (44.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('subtitle', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:12', '2012-03-13 09:36:12', NULL, 12, 7, NULL, 'icon_text')[0m
  [1m[35mSQL (45.8ms)[0m  COMMIT
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 15) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:12', '2012-03-13 09:36:12', 0.0, 15)[0m
  [1m[35mSQL (45.8ms)[0m  COMMIT
  [1m[36mSQL (47.8ms)[0m  [1mupdate accounts set balance = balance + 1000 where id = 4[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 4 LIMIT 1
  Processing by AdRequestsController#index as JSON
  Parameters: {"last_ad"=>7, "app"=>"Zv2NA1hBqYGHx5Lx2PUw", "size"=>"banner", "device"=>"mobile_phone"}
Geokit is using the domain: test.host
  [1m[36mAdContainer Load (0.3ms)[0m  [1mSELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'Zv2NA1hBqYGHx5Lx2PUw' LIMIT 1[0m
found container #<Application:0xb53d9860>
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 13 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 13) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAdRequest Load (0.2ms)[0m  SELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258270 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_requests` (`pay_method_id`, `shown`, `advertisement_id`, `publisher_share_rate`, `unit_price`, `ad_owner_id`, `agent_id`, `request_date`, `fulfilled`, `updated_at`, `size_code`, `ip_address`, `agent_share_rate`, `campaign_id`, `publish_policy_id`, `publisher_id`, `ad_container_id`, `clicked`, `paid`, `created_at`) VALUES (NULL, 0, NULL, NULL, NULL, NULL, NULL, '2012-03-13', 0, '2012-03-13 09:36:12', 'banner', '0.0.0.0', NULL, NULL, NULL, 13, 298258270, 0, 0, '2012-03-13 09:36:12')
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258270[0m
  [1m[35mSQL (46.3ms)[0m  COMMIT
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258270 )[0m
  [1m[35mAdShowControl Load (0.3ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882964) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (not (advertisement_id = 7)) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258270\'%'))) ORDER BY weight * rand() desc LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.0ms)[0m  COMMIT
Completed 200 OK in 57ms (Views: 0.3ms | ActiveRecord: 1104.1ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_14') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:12', 'Party_14\'s address', 0, '2012-03-13 09:36:12', 'Party_14', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:12', '2012-03-13 09:36:12', 'Channe_3', 'Channe_3')
  [1m[36mSQL (46.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 19 AND (`ad_containers`.`name` = BINARY 'AdContainer_3') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'ITv8tiyjn2kaF0yrqnOY'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `description`, `name`, `request_count`, `status`, `updated_at`, `show_count`, `os_type`, `created_at`, `income`, `latitude`, `channel_id`, `type`, `click_count`, `party_id`, `longitude`) VALUES ('http://www.adhub.com/AdContainer_3', 'ITv8tiyjn2kaF0yrqnOY', 'desc', 'AdContainer_3', 0, 1, '2012-03-13 09:36:12', 0, 0, '2012-03-13 09:36:12', 0.0, NULL, 417882965, 'Application', 0, 19, NULL)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 19) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (65.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_15') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:12', 'Party_15\'s address', 0, '2012-03-13 09:36:12', 'Party_15', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.3ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:12', '2012-03-13 09:36:12', 1000, 'pm_4', 0)[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_16') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:12', 'Party_16\'s address', 0, '2012-03-13 09:36:12', 'Party_16', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:12', 'Campaign_4', '2012-04-13', '2012-03-13 09:36:12', '2012-03-13', 0.0, 21, 1000.0, 'desc')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.4ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('Ad_4', 'http://www.ad.com/Ad_4', 'icon_text', 0, '2012-03-13 09:36:12', 1, 0, 21, '2012-03-13 09:36:12', 2, 0, 0)[0m
  [1m[35mSQL (44.8ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_4', '2012-03-13 09:36:12', 10.0, 6, 100.0, 1, 0.0, '2012-03-13', 417882965, 8, '2012-04-13', 6, 1, NULL, 'url', '2012-03-13 09:36:12')
  [1m[36mSQL (44.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `publish_policies` SET `updated_at` = '2012-03-13 09:36:12', `status` = 3, `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 6[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882965 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882965 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 6 )
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 6 )[0m
  [1m[35mAdShowControl Load (0.2ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 6) LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_show_controls` (`campaign_id`, `publish_policy_id`, `advertisement_id`, `created_at`, `content_categories`, `channel_id`, `unit_price`, `updated_at`, `end`, `weight`, `begin`, `ad_format`, `ad_containers`, `party_id`, `size_codes`) VALUES (6, 6, 8, '2012-03-13 09:36:12', NULL, 417882965, 0.01, '2012-03-13 09:36:12', '2012-04-13', 1.0, '2012-03-13', 'icon_text', NULL, 21, NULL)[0m
  [1m[35mSQL (48.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:12', '2012-03-13 09:36:12', '2013-03-13', 0.8, 19, '123456', 0, 'person', 0.9)
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_17') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:12', 'Party_17\'s address', 0, '2012-03-13 09:36:12', 'Party_17', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (42.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_7 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:13', 0, 22, 1, 'member_7 @abc.com', '00176025ffd5d2a2d325cc1c47dc8427', 'member_7 ', '2012-03-13 09:36:13')
  [1m[36mSQL (44.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('icon', NULL, 80, 'image/jpeg', 'icon_text_icon.jpg', '2012-03-13 09:36:13', '2012-03-13 09:36:13', 80, 13, 8, 'square', 'icon_text')[0m
  [1m[35mSQL (39.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_18') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:13', 'Party_18\'s address', 0, '2012-03-13 09:36:13', 'Party_18', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (31.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_8 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:13', 0, 23, 1, 'member_8 @abc.com', '99e678d8064fda5cd35f82f75f6afd6f', 'member_8 ', '2012-03-13 09:36:13')[0m
  [1m[35mSQL (32.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('title', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:13', '2012-03-13 09:36:13', NULL, 14, 8, NULL, 'icon_text')
  [1m[36mSQL (33.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_19') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:13', 'Party_19\'s address', 0, '2012-03-13 09:36:13', 'Party_19', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (31.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_9 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:13', 0, 24, 1, 'member_9 @abc.com', 'c617f3afe83c4324198b6db499ecb918', 'member_9 ', '2012-03-13 09:36:13')
  [1m[36mSQL (32.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('subtitle', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:13', '2012-03-13 09:36:13', NULL, 15, 8, NULL, 'icon_text')[0m
  [1m[35mSQL (33.8ms)[0m  COMMIT
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 21) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:13', '2012-03-13 09:36:13', 0.0, 21)[0m
  [1m[35mSQL (33.5ms)[0m  COMMIT
  [1m[36mSQL (35.8ms)[0m  [1mupdate accounts set balance = balance + 1000 where id = 5[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 5 LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `accounts` SET `updated_at` = '2012-03-13 09:36:13', `balance` = 0.0 WHERE `accounts`.`id` = 5
  [1m[36mSQL (33.6ms)[0m  [1mCOMMIT[0m
  Processing by AdRequestsController#index as JSON
  Parameters: {"app"=>"ITv8tiyjn2kaF0yrqnOY", "size"=>"banner", "device"=>"mobile_phone"}
Geokit is using the domain: test.host
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'ITv8tiyjn2kaF0yrqnOY' LIMIT 1
found container #<Application:0xb517d080>
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 19 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 19) AND (expired_at >= '2012-03-13' )
  [1m[36mAdRequest Load (0.2ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258271 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_requests` (`pay_method_id`, `shown`, `advertisement_id`, `publisher_share_rate`, `unit_price`, `ad_owner_id`, `agent_id`, `request_date`, `fulfilled`, `updated_at`, `size_code`, `ip_address`, `agent_share_rate`, `campaign_id`, `publish_policy_id`, `publisher_id`, `ad_container_id`, `clicked`, `paid`, `created_at`) VALUES (NULL, 0, NULL, NULL, NULL, NULL, NULL, '2012-03-13', 0, '2012-03-13 09:36:13', 'banner', '0.0.0.0', NULL, NULL, NULL, 19, 298258271, 0, 0, '2012-03-13 09:36:13')[0m
  [1m[35mAREL (0.1ms)[0m  UPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258271
  [1m[36mSQL (40.0ms)[0m  [1mCOMMIT[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258271 )
  [1m[36mAdShowControl Load (0.3ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882965) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258271\'%'))) ORDER BY weight * rand() desc LIMIT 1[0m
  [1m[35mPublishPolicy Load (0.2ms)[0m  SELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 6 LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`publish_policy_id` = 6 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1[0m
  [1m[35mCampaign Load (0.2ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 6 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`campaign_id` = 6 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 21 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 21) LIMIT 1[0m
  [1m[35mAdShowControl Load (0.3ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882965) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258271\'%'))) and (not (id in (4)))) ORDER BY weight * rand() desc LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.0ms)[0m  COMMIT
Completed 200 OK in 57ms (Views: 0.3ms | ActiveRecord: 1062.4ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_20') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:13', 'Party_20\'s address', 0, '2012-03-13 09:36:13', 'Party_20', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:13', '2012-03-13 09:36:13', 'Channe_4', 'Channe_4')
  [1m[36mSQL (46.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 25 AND (`ad_containers`.`name` = BINARY 'AdContainer_4') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'JJT5T76xi4rdtOxPnA1G'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `description`, `name`, `request_count`, `status`, `updated_at`, `show_count`, `os_type`, `created_at`, `income`, `latitude`, `channel_id`, `type`, `click_count`, `party_id`, `longitude`) VALUES ('http://www.adhub.com/AdContainer_4', 'JJT5T76xi4rdtOxPnA1G', 'desc', 'AdContainer_4', 0, 1, '2012-03-13 09:36:13', 0, 0, '2012-03-13 09:36:13', 0.0, NULL, 417882966, 'Application', 0, 25, NULL)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 25) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (65.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_21') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:13', 'Party_21\'s address', 0, '2012-03-13 09:36:13', 'Party_21', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:13', '2012-03-13 09:36:13', 1000, 'pm_5', 0)[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_22') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:13', 'Party_22\'s address', 0, '2012-03-13 09:36:13', 'Party_22', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (55.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:14', 'Campaign_5', '2012-04-13', '2012-03-13 09:36:14', '2012-03-13', 0.0, 27, 1000.0, 'desc')
  [1m[36mSQL (58.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('Ad_5', 'http://www.ad.com/Ad_5', 'icon_text', 0, '2012-03-13 09:36:14', 1, 0, 27, '2012-03-13 09:36:14', 2, 0, 0)[0m
  [1m[35mSQL (57.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_5', '2012-03-13 09:36:14', 10.0, 7, 100.0, 1, 0.0, '2012-03-13', 417882966, 9, '2012-04-13', 7, 1, NULL, 'url', '2012-03-13 09:36:14')
  [1m[36mSQL (56.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `publish_policies` SET `updated_at` = '2012-03-13 09:36:14', `status` = 3, `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 7[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882966 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882966 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.1ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 7 )
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 7 )[0m
  [1m[35mAdShowControl Load (0.1ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 7) LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_show_controls` (`campaign_id`, `publish_policy_id`, `advertisement_id`, `created_at`, `content_categories`, `channel_id`, `unit_price`, `updated_at`, `end`, `weight`, `begin`, `ad_format`, `ad_containers`, `party_id`, `size_codes`) VALUES (7, 7, 9, '2012-03-13 09:36:14', NULL, 417882966, 0.01, '2012-03-13 09:36:14', '2012-04-13', 1.0, '2012-03-13', 'icon_text', NULL, 27, NULL)[0m
  [1m[35mSQL (60.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:14', '2012-03-13 09:36:14', '2013-03-13', 0.8, 25, '123456', 0, 'person', 0.9)
  [1m[36mSQL (56.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_23') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:14', 'Party_23\'s address', 0, '2012-03-13 09:36:14', 'Party_23', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_10 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:14', 0, 28, 1, 'member_10 @abc.com', '9cb5001a7f847fcd3eb9b82c979a4d02', 'member_10 ', '2012-03-13 09:36:14')
  [1m[36mSQL (44.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('icon', NULL, 80, 'image/jpeg', 'icon_text_icon.jpg', '2012-03-13 09:36:14', '2012-03-13 09:36:14', 80, 16, 9, 'square', 'icon_text')[0m
  [1m[35mSQL (49.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_24') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:14', 'Party_24\'s address', 0, '2012-03-13 09:36:14', 'Party_24', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (54.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_11 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:14', 0, 29, 1, 'member_11 @abc.com', '59b700d2b4f3c35160c934fa78e26689', 'member_11 ', '2012-03-13 09:36:14')[0m
  [1m[35mSQL (56.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('title', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:14', '2012-03-13 09:36:14', NULL, 17, 9, NULL, 'icon_text')
  [1m[36mSQL (57.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_25') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:14', 'Party_25\'s address', 0, '2012-03-13 09:36:14', 'Party_25', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (55.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_12 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:14', 0, 30, 1, 'member_12 @abc.com', '3f6153be988c9659c414b5b10226456e', 'member_12 ', '2012-03-13 09:36:14')
  [1m[36mSQL (56.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('subtitle', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:14', '2012-03-13 09:36:14', NULL, 18, 9, NULL, 'icon_text')[0m
  [1m[35mSQL (45.8ms)[0m  COMMIT
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 27) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:14', '2012-03-13 09:36:14', 0.0, 27)[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mSQL (47.8ms)[0m  [1mupdate accounts set balance = balance + 1000 where id = 6[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 6 LIMIT 1
  Processing by AdRequestsController#index as JSON
  Parameters: {"app"=>"JJT5T76xi4rdtOxPnA1G", "size"=>"banner", "device"=>"mobile_phone"}
Geokit is using the domain: test.host
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'JJT5T76xi4rdtOxPnA1G' LIMIT 1[0m
found container #<Application:0xb541f220>
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 25 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 25) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAdRequest Load (0.2ms)[0m  SELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258272 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_requests` (`pay_method_id`, `shown`, `advertisement_id`, `publisher_share_rate`, `unit_price`, `ad_owner_id`, `agent_id`, `request_date`, `fulfilled`, `updated_at`, `size_code`, `ip_address`, `agent_share_rate`, `campaign_id`, `publish_policy_id`, `publisher_id`, `ad_container_id`, `clicked`, `paid`, `created_at`) VALUES (NULL, 0, NULL, NULL, NULL, NULL, NULL, '2012-03-13', 0, '2012-03-13 09:36:14', 'banner', '0.0.0.0', NULL, NULL, NULL, 25, 298258272, 0, 0, '2012-03-13 09:36:14')
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258272[0m
  [1m[35mSQL (38.4ms)[0m  COMMIT
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258272 )[0m
  [1m[35mAdShowControl Load (0.3ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882966) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258272\'%'))) ORDER BY weight * rand() desc LIMIT 1
  [1m[36mPublishPolicy Load (0.2ms)[0m  [1mSELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 7 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`publish_policy_id` = 7 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1
  [1m[36mCampaign Load (0.2ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 7 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`campaign_id` = 7 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 27 LIMIT 1[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 27) LIMIT 1
  [1m[36mPayMethod Load (0.1ms)[0m  [1mSELECT `pay_methods`.* FROM `pay_methods` WHERE `pay_methods`.`id` = 7 LIMIT 1[0m
  [1m[35mAdvertisement Load (0.1ms)[0m  SELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 9 LIMIT 1
  [1m[36mCampaign Load (0.0ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 7 LIMIT 1[0m
  [1m[35mParty Load (0.0ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 27 LIMIT 1
  [1m[36mContract Load (0.2ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 25) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `ad_requests` SET `pay_method_id` = 7, `advertisement_id` = 9, `publisher_share_rate` = 0.8, `unit_price` = 0.01, `ad_owner_id` = 27, `fulfilled` = 1, `updated_at` = '2012-03-13 09:36:14', `agent_share_rate` = 0.0, `campaign_id` = 7, `publish_policy_id` = 7 WHERE `ad_requests`.`id` = 980190966[0m
  [1m[35mSQL (46.1ms)[0m  COMMIT
  [1m[36mAdvertisement Load (0.1ms)[0m  [1mSELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 9 LIMIT 1[0m
advertisement = #<Advertisement:0xb53e1484>
  [1m[35mAdResource Load (0.2ms)[0m  SELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'icon' AND (`ad_resources`.advertisement_id = 9) LIMIT 1
  [1m[36mAdResource Load (0.2ms)[0m  [1mSELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'title' AND (`ad_resources`.advertisement_id = 9) LIMIT 1[0m
  [1m[35mAdResource Load (0.2ms)[0m  SELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'subtitle' AND (`ad_resources`.advertisement_id = 9) LIMIT 1
Completed 200 OK in 111ms (Views: 0.7ms | ActiveRecord: 1303.2ms)
  [1m[36mAdRequest Load (0.3ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190966 LIMIT 1[0m
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`id` = 298258272 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_26') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:15', 'Party_26\'s address', 0, '2012-03-13 09:36:15', 'Party_26', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:15', '2012-03-13 09:36:15', 'Channe_5', 'Channe_5')
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 31 AND (`ad_containers`.`name` = BINARY 'AdContainer_5') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = '1E2UzMjW9YZoYkfDtUVN'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `description`, `name`, `request_count`, `status`, `updated_at`, `show_count`, `os_type`, `created_at`, `income`, `latitude`, `channel_id`, `type`, `click_count`, `party_id`, `longitude`) VALUES ('http://www.adhub.com/AdContainer_5', '1E2UzMjW9YZoYkfDtUVN', 'desc', 'AdContainer_5', 0, 1, '2012-03-13 09:36:15', 0, 0, '2012-03-13 09:36:15', 0.0, NULL, 417882967, 'Application', 0, 31, NULL)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 31) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (53.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_27') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:15', 'Party_27\'s address', 0, '2012-03-13 09:36:15', 'Party_27', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:15', '2012-03-13 09:36:15', 1000, 'pm_6', 0)[0m
  [1m[35mSQL (46.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_28') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:15', 'Party_28\'s address', 0, '2012-03-13 09:36:15', 'Party_28', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:15', 'Campaign_6', '2012-04-13', '2012-03-13 09:36:15', '2012-03-13', 0.0, 33, 1000.0, 'desc')
  [1m[36mSQL (45.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('Ad_6', 'http://www.ad.com/Ad_6', 'icon_text', 0, '2012-03-13 09:36:15', 1, 0, 33, '2012-03-13 09:36:15', 2, 0, 0)[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_6', '2012-03-13 09:36:15', 10.0, 8, 100.0, 1, 0.0, '2012-03-13', 417882967, 10, '2012-04-13', 8, 1, NULL, 'url', '2012-03-13 09:36:15')
  [1m[36mSQL (44.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (191.1ms)[0m  [1mUPDATE `publish_policies` SET `updated_at` = '2012-03-13 09:36:15', `status` = 3, `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 8[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882967 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882967 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 8 )
  [1m[36mAdContainer Load (0.1ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 8 )[0m
  [1m[35mAdShowControl Load (0.1ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 8) LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_show_controls` (`campaign_id`, `publish_policy_id`, `advertisement_id`, `created_at`, `content_categories`, `channel_id`, `unit_price`, `updated_at`, `end`, `weight`, `begin`, `ad_format`, `ad_containers`, `party_id`, `size_codes`) VALUES (8, 8, 10, '2012-03-13 09:36:15', NULL, 417882967, 0.01, '2012-03-13 09:36:15', '2012-04-13', 1.0, '2012-03-13', 'icon_text', NULL, 33, NULL)[0m
  [1m[35mSQL (38.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:15', '2012-03-13 09:36:15', '2013-03-13', 0.8, 31, '123456', 0, 'person', 0.9)
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_29') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:15', 'Party_29\'s address', 0, '2012-03-13 09:36:15', 'Party_29', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (31.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_13 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:15', 0, 34, 1, 'member_13 @abc.com', '7380f249abaa937f0947f7875ba772ae', 'member_13 ', '2012-03-13 09:36:15')
  [1m[36mSQL (32.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('icon', NULL, 80, 'image/jpeg', 'icon_text_icon.jpg', '2012-03-13 09:36:15', '2012-03-13 09:36:15', 80, 19, 10, 'square', 'icon_text')[0m
  [1m[35mSQL (39.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_30') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:16', 'Party_30\'s address', 0, '2012-03-13 09:36:16', 'Party_30', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_14 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:16', 0, 35, 1, 'member_14 @abc.com', '7f25b54da746ec068d8afe5224e7a7e5', 'member_14 ', '2012-03-13 09:36:16')[0m
  [1m[35mSQL (44.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('title', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:16', '2012-03-13 09:36:16', NULL, 20, 10, NULL, 'icon_text')
  [1m[36mSQL (45.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_31') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:16', 'Party_31\'s address', 0, '2012-03-13 09:36:16', 'Party_31', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_15 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:16', 0, 36, 1, 'member_15 @abc.com', '1bd941e0cae5438939edb68b0a24b6f2', 'member_15 ', '2012-03-13 09:36:16')
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`name`, `text`, `height`, `file_content_type`, `file`, `updated_at`, `created_at`, `width`, `member_id`, `advertisement_id`, `size_code`, `ad_format`) VALUES ('subtitle', 'Text', NULL, NULL, NULL, '2012-03-13 09:36:16', '2012-03-13 09:36:16', NULL, 21, 10, NULL, 'icon_text')[0m
  [1m[35mSQL (45.9ms)[0m  COMMIT
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:16', '2012-03-13 09:36:16', 0.0, 33)[0m
  [1m[35mSQL (45.9ms)[0m  COMMIT
  [1m[36mSQL (47.8ms)[0m  [1mupdate accounts set balance = balance + 1000 where id = 7[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 7 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_requests` (`pay_method_id`, `shown`, `advertisement_id`, `publisher_share_rate`, `unit_price`, `ad_owner_id`, `agent_id`, `request_date`, `fulfilled`, `updated_at`, `size_code`, `ip_address`, `agent_share_rate`, `campaign_id`, `publish_policy_id`, `publisher_id`, `ad_container_id`, `clicked`, `paid`, `created_at`) VALUES (NULL, 0, NULL, NULL, NULL, NULL, NULL, '2012-03-13', 0, '2012-03-13 09:36:16', 'banner', '127.0.0.1', NULL, NULL, NULL, 31, 298258273, 0, 0, '2012-03-13 09:36:16')
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258273[0m
  [1m[35mSQL (44.3ms)[0m  COMMIT
  [1m[36mContract Load (0.2ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 31) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.3ms)[0m  [1mUPDATE `ad_requests` SET `pay_method_id` = 8, `advertisement_id` = 10, `publisher_share_rate` = 0.8, `unit_price` = 0.01, `ad_owner_id` = 33, `fulfilled` = 1, `updated_at` = '2012-03-13 09:36:16', `agent_share_rate` = 0.0, `campaign_id` = 8, `publish_policy_id` = 8 WHERE `ad_requests`.`id` = 980190967[0m
  [1m[35mSQL (44.3ms)[0m  COMMIT
  [1m[36mSQL (47.8ms)[0m  [1mupdate accounts set balance = balance + 100 where id = 7[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 7 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 31) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:16', '2012-03-13 09:36:16', 0.0, 31)[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  Processing by AdRequestsController#shown as HTML
  Parameters: {"id"=>980190967}
Geokit is using the domain: test.host
  [1m[36mAdRequest Load (0.3ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190967 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAdvertisement Load (0.1ms)[0m  [1mSELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 10 LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  UPDATE `advertisements` SET `impression_count` = COALESCE(`impression_count`, 0) + 1 WHERE `advertisements`.`id` = 10
  [1m[36mPayMethod Load (0.1ms)[0m  [1mSELECT `pay_methods`.* FROM `pay_methods` WHERE `pay_methods`.`id` = 8 LIMIT 1[0m
  [1m[35mPublishPolicy Load (0.1ms)[0m  SELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 8 LIMIT 1
  [1m[36mAdvertisement Load (0.1ms)[0m  [1mSELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 10 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 33 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  update accounts set balance = balance - 0.01 where id = 7
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 7 LIMIT 1[0m
  [1m[35mCampaign Load (0.2ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 8 LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mupdate campaigns set used_budget = used_budget + 0.01 where id = 8[0m
  [1m[35mCampaign Load (0.2ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 8 LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mupdate publish_policies set used_budget = used_budget + 0.01 where id = 8[0m
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`id` = 298258273 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mupdate ad_containers set income = income + 0.008 where id = 298258273[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 31 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 31) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  update accounts set balance = balance + 0.008 where id = 8
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 8 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`adhub_operator` = 1 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 1) LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:16', '2012-03-13 09:36:16', 0.0, 1)
  [1m[36mSQL (0.1ms)[0m  [1mupdate accounts set balance = balance + 0.002 where id = 9[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 9 LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `ad_requests` SET `updated_at` = '2012-03-13 09:36:16', `paid` = 1 WHERE `ad_requests`.`id` = 980190967[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 33 LIMIT 1
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 33 LIMIT 1[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `ad_requests` SET `shown` = 1, `updated_at` = '2012-03-13 09:36:16' WHERE `ad_requests`.`id` = 980190967[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `ad_containers` SET `show_count` = COALESCE(`show_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258273
  [1m[36mSQL (48.6ms)[0m  [1mCOMMIT[0m
Completed 200 OK in 90ms (Views: 18.7ms | ActiveRecord: 1456.9ms)
  [1m[35mAdRequest Load (0.2ms)[0m  SELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190967 LIMIT 1
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 31) LIMIT 1
  [1m[36mCampaign Load (0.2ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 8 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_32') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:17', 'Party_32\'s address', 0, '2012-03-13 09:36:17', 'Party_32', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_16 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:17', 1, 37, 1, 'member_16 @abc.com', '3fc9ad5958e94a01ed0a3807676c5c0e', 'member_16 ', '2012-03-13 09:36:17')
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_33') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:17', 'Party_33\'s address', 0, '2012-03-13 09:36:17', 'Party_33', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  Processing by Admin::ContractsController#new as HTML
  Parameters: {"business_type"=>0, "party_id"=>38}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 22 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 38 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 37 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 37) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:17', '2012-03-13 09:36:17', 0.0, 37)[0m
  [1m[35mSQL (58.4ms)[0m  COMMIT
Rendered _page_head.html.erb (70.0ms)
Rendered side_bar/_admin_console.html.erb (2.9ms)
Rendered _page_foot.html.erb (0.3ms)
Completed 200 OK in 428ms (Views: 366.3ms | ActiveRecord: 353.2ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_34') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:17', 'Party_34\'s address', 0, '2012-03-13 09:36:17', 'Party_34', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (67.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_17 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:17', 1, 39, 1, 'member_17 @abc.com', '04162fd76926174c6589492dbb28f04b', 'member_17 ', '2012-03-13 09:36:17')[0m
  [1m[35mSQL (92.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_35') LIMIT 1
  [1m[36mAREL (56.7ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:17', 'Party_35\'s address', 0, '2012-03-13 09:36:17', 'Party_35', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (71.3ms)[0m  COMMIT
  Processing by Admin::ContractsController#create as HTML
  Parameters: {"party_id"=>40, "contract"=>{"contact_person"=>"person", "business_type"=>2, "start_from"=>Tue, 13 Mar 2012, "expired_at"=>Wed, 13 Mar 2013, "mobile_phone"=>"123456"}}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 23 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 40 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:18', '2012-03-13 09:36:18', '2013-03-13', NULL, 40, '123456', 0, 'person', NULL)
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 40 LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `parties` SET `updated_at` = '2012-03-13 09:36:18', `agent_id` = 39 WHERE `parties`.`id` = 40
Redirected to http://test.host/admin/parties/40.html
  [1m[36mSQL (107.8ms)[0m  [1mCOMMIT[0m
Completed 302 Found in 114ms
  [1m[35mParty Load (0.3ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 40 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 39 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_36') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:18', 'Party_36\'s address', 0, '2012-03-13 09:36:18', 'Party_36', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:18', '2012-03-13 09:36:18', '2013-03-13', NULL, 41, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_18 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:18', 0, 41, 1, 'member_18 @abc.com', '374c8d45279fe944595a128b4706b2dd', 'member_18 ', '2012-03-13 09:36:18')[0m
  [1m[35mSQL (43.7ms)[0m  COMMIT
  [1m[36mRole Load (0.1ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 24)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 24)[0m
  [1m[35mSQL (46.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:18', 'ad_party1\'s address', 0, '2012-03-13 09:36:18', 'ad_party1', '12345678', 41, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:18', '2012-03-13 09:36:18', '2013-03-13', NULL, 42, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:19', 'ad_party2\'s address', 1, '2012-03-13 09:36:19', 'ad_party2', '12345678', 41, 0, NULL, 0, 0)
  [1m[36mSQL (45.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:19', '2012-03-13 09:36:19', '2013-03-13', NULL, 43, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  Processing by PartiesController#new as HTML
Geokit is using the domain: test.host
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
check_result is true
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
Rendered parties/_f.html.erb (2.5ms)
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 4) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:19', '2012-03-13 09:36:19', 0.0, 4)
  [1m[36mSQL (48.4ms)[0m  [1mCOMMIT[0m
Rendered _page_head.html.erb (61.7ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 80ms (Views: 25.1ms | ActiveRecord: 1174.6ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_37') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:19', 'Party_37\'s address', 0, '2012-03-13 09:36:19', 'Party_37', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:19', '2012-03-13 09:36:19', '2013-03-13', NULL, 44, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (57.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_19 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:19', 0, 44, 1, 'member_19 @abc.com', '5d1213916ba93e615ac6877d1c6d80ec', 'member_19 ', '2012-03-13 09:36:19')[0m
  [1m[35mSQL (43.7ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 25)[0m
  [1m[35mSQL (46.5ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 25)[0m
  [1m[35mSQL (46.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:19', 'ad_party1\'s address', 0, '2012-03-13 09:36:19', 'ad_party1', '12345678', 44, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:19', '2012-03-13 09:36:19', '2013-03-13', NULL, 45, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:19', 'ad_party2\'s address', 1, '2012-03-13 09:36:19', 'ad_party2', '12345678', 44, 0, NULL, 0, 0)
  [1m[36mSQL (43.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:19', '2012-03-13 09:36:19', '2013-03-13', NULL, 46, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 5 LIMIT 1
  Processing by PartiesController#edit as HTML
  Parameters: {"id"=>#<Party id: 5, agent_id: 4, party_type: nil, adhub_operator: false, name: "Ad Owner with Agent", address: nil, phone_number: nil, post_code: nil, created_at: "2012-03-13 09:36:19", updated_at: "2012-03-13 09:36:19", sales_id: 6, ad_maintained_by: 0, archived: false>}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.0ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 5 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )
  [1m[36mSQL (17.9ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
check_result is true
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
Rendered parties/_f.html.erb (2.0ms)
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 5) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 4) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:19', '2012-03-13 09:36:19', 0.0, 4)[0m
  [1m[35mSQL (48.0ms)[0m  COMMIT
Rendered _page_head.html.erb (64.7ms)
Rendered side_bar/_agent.html.erb (1.1ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 191ms (Views: 49.2ms | ActiveRecord: 537.9ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_38') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:20', 'Party_38\'s address', 0, '2012-03-13 09:36:20', 'Party_38', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:20', '2012-03-13 09:36:20', '2013-03-13', NULL, 47, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_20 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:20', 0, 47, 1, 'member_20 @abc.com', '8e67723e777fe29a11ac4eca2b688a92', 'member_20 ', '2012-03-13 09:36:20')
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (1.8ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (26, 1)
  [1m[36mSQL (44.4ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (26, 4)
  [1m[36mSQL (34.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:20', 'ad_party1\'s address', 0, '2012-03-13 09:36:20', 'ad_party1', '12345678', 47, 0, NULL, 0, 0)
  [1m[36mSQL (32.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:20', '2012-03-13 09:36:20', '2013-03-13', NULL, 48, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (33.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:20', 'ad_party2\'s address', 1, '2012-03-13 09:36:20', 'ad_party2', '12345678', 47, 0, NULL, 0, 0)[0m
  [1m[35mSQL (31.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:20', '2012-03-13 09:36:20', '2013-03-13', NULL, 49, '123456', 0, 'person', NULL)
  [1m[36mSQL (33.3ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  Processing by PartiesController#index as HTML
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.4ms)[0m  [1mSELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 4)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0[0m
  [1m[35mParty Load (0.3ms)[0m  SELECT `parties`.`id` AS t0_r0, `parties`.`agent_id` AS t0_r1, `parties`.`party_type` AS t0_r2, `parties`.`adhub_operator` AS t0_r3, `parties`.`name` AS t0_r4, `parties`.`address` AS t0_r5, `parties`.`phone_number` AS t0_r6, `parties`.`post_code` AS t0_r7, `parties`.`created_at` AS t0_r8, `parties`.`updated_at` AS t0_r9, `parties`.`sales_id` AS t0_r10, `parties`.`ad_maintained_by` AS t0_r11, `parties`.`archived` AS t0_r12, `contracts`.`id` AS t1_r0, `contracts`.`business_type` AS t1_r1, `contracts`.`party_id` AS t1_r2, `contracts`.`expiration_processed` AS t1_r3, `contracts`.`start_from` AS t1_r4, `contracts`.`expired_at` AS t1_r5, `contracts`.`contact_person` AS t1_r6, `contracts`.`mobile_phone` AS t1_r7, `contracts`.`created_at` AS t1_r8, `contracts`.`updated_at` AS t1_r9, `contracts`.`share_rate_1` AS t1_r10, `contracts`.`share_rate_2` AS t1_r11 FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE `parties`.`id` IN (5) AND ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 4)) ORDER BY parties.created_at desc
  [1m[36mContract Load (0.2ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 5) LIMIT 1[0m
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 5)[0m
Rendered parties/_party.html.erb (6.1ms)
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mRole Load (0.3ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 4) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:20', '2012-03-13 09:36:20', 0.0, 4)
  [1m[36mSQL (30.5ms)[0m  [1mCOMMIT[0m
Rendered _page_head.html.erb (45.7ms)
Rendered side_bar/_agent.html.erb (0.6ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 68ms (Views: 28.5ms | ActiveRecord: 438.5ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_39') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:20', 'Party_39\'s address', 0, '2012-03-13 09:36:20', 'Party_39', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:20', '2012-03-13 09:36:20', '2013-03-13', NULL, 50, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_21 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:20', 0, 50, 1, 'member_21 @abc.com', 'e8e170542da1155fd109f50a4a46c2e2', 'member_21 ', '2012-03-13 09:36:20')[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 27)[0m
  [1m[35mSQL (46.4ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (27, 4)[0m
  [1m[35mSQL (46.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:20', 'ad_party1\'s address', 0, '2012-03-13 09:36:20', 'ad_party1', '12345678', 50, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:20', '2012-03-13 09:36:20', '2013-03-13', NULL, 51, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:20', 'ad_party2\'s address', 1, '2012-03-13 09:36:20', 'ad_party2', '12345678', 50, 0, NULL, 0, 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:20', '2012-03-13 09:36:20', '2013-03-13', NULL, 52, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1
  Processing by PartiesController#edit as HTML
  Parameters: {"id"=>#<Party id: 3, agent_id: nil, party_type: nil, adhub_operator: false, name: "Ad Owner", address: nil, phone_number: nil, post_code: nil, created_at: "2012-03-13 09:36:20", updated_at: "2012-03-13 09:36:20", sales_id: nil, ad_maintained_by: 0, archived: false>}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
check_result is false
Redirected to http://test.host/
Completed 302 Found in 5ms
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_40') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:21', 'Party_40\'s address', 0, '2012-03-13 09:36:21', 'Party_40', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (45.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:21', '2012-03-13 09:36:21', '2013-03-13', NULL, 53, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (68.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_22 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:21', 0, 53, 1, 'member_22 @abc.com', 'bdd4ecf88808ba4d32b6c7711fd2e1eb', 'member_22 ', '2012-03-13 09:36:21')[0m
  [1m[35mSQL (39.8ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (28, 1)[0m
  [1m[35mSQL (46.1ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 28)[0m
  [1m[35mSQL (46.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:21', 'ad_party1\'s address', 0, '2012-03-13 09:36:21', 'ad_party1', '12345678', 53, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:21', '2012-03-13 09:36:21', '2013-03-13', NULL, 54, '123456', 0, 'person', NULL)
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:21', 'ad_party2\'s address', 1, '2012-03-13 09:36:21', 'ad_party2', '12345678', 53, 0, NULL, 0, 0)
  [1m[36mSQL (43.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:21', '2012-03-13 09:36:21', '2013-03-13', NULL, 55, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  [1m[36mContract Load (0.2ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE (`contracts`.party_id = 54)[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `contracts` SET `updated_at` = '2012-03-13 09:36:21', `expiration_processed` = 1 WHERE `contracts`.`id` = 24[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 54 LIMIT 1[0m
  Processing by PartiesController#archived as JS
  Parameters: {"id"=>54}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 28 LIMIT 1
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 54 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 53 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 28 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 53) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 53 LIMIT 1[0m
check_result is true
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 54)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') AND (`parties`.id <> 54) LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `parties` SET `updated_at` = '2012-03-13 09:36:21', `archived` = 1 WHERE `parties`.`id` = 54[0m
  [1m[35mSQL (47.3ms)[0m  COMMIT
now archived party.id is 54
Completed 200 OK in 84ms (Views: 25.9ms | ActiveRecord: 1051.8ms)
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 54 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_41') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:21', 'Party_41\'s address', 0, '2012-03-13 09:36:21', 'Party_41', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:21', '2012-03-13 09:36:21', '2013-03-13', NULL, 56, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_23 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:22', 0, 56, 1, 'member_23 @abc.com', 'cf991458faab4fdae894cc5518446297', 'member_23 ', '2012-03-13 09:36:22')[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (29, 1)[0m
  [1m[35mSQL (46.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (29, 4)[0m
  [1m[35mSQL (46.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:22', 'ad_party1\'s address', 0, '2012-03-13 09:36:22', 'ad_party1', '12345678', 56, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:22', '2012-03-13 09:36:22', '2013-03-13', NULL, 57, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:22', 'ad_party2\'s address', 1, '2012-03-13 09:36:22', 'ad_party2', '12345678', 56, 0, NULL, 0, 0)
  [1m[36mSQL (43.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:22', '2012-03-13 09:36:22', '2013-03-13', NULL, 58, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (33.2ms)[0m  COMMIT
  Processing by PartiesController#archived as JS
  Parameters: {"id"=>57}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 29 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 57 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 56 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 29 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 56) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.0ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 56 LIMIT 1
check_result is true
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 57)[0m
Completed 200 OK in 6ms (Views: 0.4ms | ActiveRecord: 451.5ms)
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 57 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_42') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:22', 'Party_42\'s address', 0, '2012-03-13 09:36:22', 'Party_42', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (32.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:22', '2012-03-13 09:36:22', '2013-03-13', NULL, 59, '123456', 0, 'person', NULL)
  [1m[36mSQL (33.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_24 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:22', 0, 59, 1, 'member_24 @abc.com', '88bacd683c1c3f0a53fe6b1036381ab8', 'member_24 ', '2012-03-13 09:36:22')
  [1m[36mSQL (55.9ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 30)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 30)
  [1m[36mSQL (46.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:22', 'ad_party1\'s address', 0, '2012-03-13 09:36:22', 'ad_party1', '12345678', 59, 0, NULL, 0, 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:22', '2012-03-13 09:36:22', '2013-03-13', NULL, 60, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:22', 'ad_party2\'s address', 1, '2012-03-13 09:36:22', 'ad_party2', '12345678', 59, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:22', '2012-03-13 09:36:22', '2013-03-13', NULL, 61, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  Processing by PartiesController#index as HTML
  Parameters: {"archived"=>"1"}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 30 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 59 LIMIT 1[0m
  [1m[35mParty Load (0.3ms)[0m  SELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.agent_id = 59)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0
  [1m[36mParty Load (0.3ms)[0m  [1mSELECT `parties`.`id` AS t0_r0, `parties`.`agent_id` AS t0_r1, `parties`.`party_type` AS t0_r2, `parties`.`adhub_operator` AS t0_r3, `parties`.`name` AS t0_r4, `parties`.`address` AS t0_r5, `parties`.`phone_number` AS t0_r6, `parties`.`post_code` AS t0_r7, `parties`.`created_at` AS t0_r8, `parties`.`updated_at` AS t0_r9, `parties`.`sales_id` AS t0_r10, `parties`.`ad_maintained_by` AS t0_r11, `parties`.`archived` AS t0_r12, `contracts`.`id` AS t1_r0, `contracts`.`business_type` AS t1_r1, `contracts`.`party_id` AS t1_r2, `contracts`.`expiration_processed` AS t1_r3, `contracts`.`start_from` AS t1_r4, `contracts`.`expired_at` AS t1_r5, `contracts`.`contact_person` AS t1_r6, `contracts`.`mobile_phone` AS t1_r7, `contracts`.`created_at` AS t1_r8, `contracts`.`updated_at` AS t1_r9, `contracts`.`share_rate_1` AS t1_r10, `contracts`.`share_rate_2` AS t1_r11 FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE `parties`.`id` IN (60, 61) AND ((contracts.business_type = 2) and (parties.agent_id = 59)) ORDER BY parties.created_at desc[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 60) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 60)[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 61) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 61)[0m
Rendered parties/_party.html.erb (8.0ms)
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 30 )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 59) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:22', '2012-03-13 09:36:22', 0.0, 59)
  [1m[36mSQL (49.4ms)[0m  [1mCOMMIT[0m
Rendered _page_head.html.erb (63.1ms)
Rendered side_bar/_agent.html.erb (0.6ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 85ms (Views: 25.4ms | ActiveRecord: 483.8ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_43') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:23', 'Party_43\'s address', 0, '2012-03-13 09:36:23', 'Party_43', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:23', '2012-03-13 09:36:23', '2013-03-13', NULL, 62, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (17.7ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_25 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:23', 0, 62, 1, 'member_25 @abc.com', '50369fc0cca5cde12ab84de92eecc695', 'member_25 ', '2012-03-13 09:36:23')[0m
  [1m[35mSQL (37.9ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 31)[0m
  [1m[35mSQL (46.3ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (31, 4)[0m
  [1m[35mSQL (47.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:23', 'ad_party1\'s address', 0, '2012-03-13 09:36:23', 'ad_party1', '12345678', 62, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:23', '2012-03-13 09:36:23', '2013-03-13', NULL, 63, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:23', 'ad_party2\'s address', 1, '2012-03-13 09:36:23', 'ad_party2', '12345678', 62, 0, NULL, 0, 0)
  [1m[36mSQL (43.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:23', '2012-03-13 09:36:23', '2013-03-13', NULL, 64, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  Processing by PartiesController#index as HTML
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 31 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 62 LIMIT 1
  [1m[36mParty Load (0.3ms)[0m  [1mSELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 62)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0[0m
  [1m[35mParty Load (0.3ms)[0m  SELECT `parties`.`id` AS t0_r0, `parties`.`agent_id` AS t0_r1, `parties`.`party_type` AS t0_r2, `parties`.`adhub_operator` AS t0_r3, `parties`.`name` AS t0_r4, `parties`.`address` AS t0_r5, `parties`.`phone_number` AS t0_r6, `parties`.`post_code` AS t0_r7, `parties`.`created_at` AS t0_r8, `parties`.`updated_at` AS t0_r9, `parties`.`sales_id` AS t0_r10, `parties`.`ad_maintained_by` AS t0_r11, `parties`.`archived` AS t0_r12, `contracts`.`id` AS t1_r0, `contracts`.`business_type` AS t1_r1, `contracts`.`party_id` AS t1_r2, `contracts`.`expiration_processed` AS t1_r3, `contracts`.`start_from` AS t1_r4, `contracts`.`expired_at` AS t1_r5, `contracts`.`contact_person` AS t1_r6, `contracts`.`mobile_phone` AS t1_r7, `contracts`.`created_at` AS t1_r8, `contracts`.`updated_at` AS t1_r9, `contracts`.`share_rate_1` AS t1_r10, `contracts`.`share_rate_2` AS t1_r11 FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE `parties`.`id` IN (63) AND ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 62)) ORDER BY parties.created_at desc
  [1m[36mContract Load (0.3ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 63) LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 63)
Rendered parties/_party.html.erb (4.9ms)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 31 )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 62) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`created_at`, `updated_at`, `balance`, `party_id`) VALUES ('2012-03-13 09:36:24', '2012-03-13 09:36:24', 0.0, 62)[0m
  [1m[35mSQL (49.1ms)[0m  COMMIT
Rendered _page_head.html.erb (65.6ms)
Rendered side_bar/_agent.html.erb (0.7ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 85ms (Views: 26.2ms | ActiveRecord: 907.4ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_44') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:24', 'Party_44\'s address', 0, '2012-03-13 09:36:24', 'Party_44', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:24', '2012-03-13 09:36:24', '2013-03-13', NULL, 65, '123456', 0, 'person', NULL)
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_26 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:24', 0, 65, 1, 'member_26 @abc.com', 'b6b5a0d49e19f804054b5b3ebdd73e1b', 'member_26 ', '2012-03-13 09:36:24')
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 32)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 32)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:24', 'ad_party1\'s address', 0, '2012-03-13 09:36:24', 'ad_party1', '12345678', 65, 0, NULL, 0, 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:24', '2012-03-13 09:36:24', '2013-03-13', NULL, 66, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:24', 'ad_party2\'s address', 1, '2012-03-13 09:36:24', 'ad_party2', '12345678', 65, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.8ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:24', '2012-03-13 09:36:24', '2013-03-13', NULL, 67, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'test@test.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:24', 0, NULL, 1, 'test@test.com', 'd1c0f0b148c57cd5e1f61522db800982', 'test', '2012-03-13 09:36:24')
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  Processing by PartiesController#new as HTML
Geokit is using the domain: test.host
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 33 LIMIT 1
check_result is true
Rendered parties/_f.html.erb (1.8ms)
Rendered _page_head.html.erb (1.1ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 8ms (Views: 6.9ms | ActiveRecord: 508.1ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_45') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:24', 'Party_45\'s address', 0, '2012-03-13 09:36:24', 'Party_45', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:24', '2012-03-13 09:36:24', '2013-03-13', NULL, 68, '123456', 0, 'person', NULL)
  [1m[36mSQL (33.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_27 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:24', 0, 68, 1, 'member_27 @abc.com', '04b5631b51b68ea89c265f52f20d1392', 'member_27 ', '2012-03-13 09:36:24')
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (34, 1)
  [1m[36mSQL (58.3ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (34, 4)
  [1m[36mSQL (94.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:25', 'ad_party1\'s address', 0, '2012-03-13 09:36:25', 'ad_party1', '12345678', 68, 0, NULL, 0, 0)
  [1m[36mSQL (55.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:25', '2012-03-13 09:36:25', '2013-03-13', NULL, 69, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (69.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:25', 'ad_party2\'s address', 1, '2012-03-13 09:36:25', 'ad_party2', '12345678', 68, 0, NULL, 0, 0)[0m
  [1m[35mSQL (67.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:25', '2012-03-13 09:36:25', '2013-03-13', NULL, 70, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'test@test.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:25', 0, NULL, 1, 'test@test.com', 'd1c0f0b148c57cd5e1f61522db800982', 'test', '2012-03-13 09:36:25')
  [1m[36mSQL (44.6ms)[0m  [1mCOMMIT[0m
  Processing by PartiesController#create as HTML
  Parameters: {"party"=>{"party_type"=>1, "address"=>"add", "post_code"=>"123456", "name"=>"test", "phone_number"=>"123"}}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 35 LIMIT 1
check_result is true
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'test') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:25', 'add', 0, '2012-03-13 09:36:25', 'test', '123', NULL, 0, NULL, 1, 0)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'test@test.com') AND (`members`.id <> 35) LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `members` SET `updated_at` = '2012-03-13 09:36:25', `party_id` = 71 WHERE `members`.`id` = 35[0m
  [1m[35mRole Load (0.1ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 35)[0m
Redirected to http://test.host/
  [1m[35mSQL (48.5ms)[0m  COMMIT
Completed 302 Found in 59ms
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 35 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 71 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 35 )[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_46') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:25', 'Party_46\'s address', 0, '2012-03-13 09:36:25', 'Party_46', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (92.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:25', '2012-03-13 09:36:25', '2013-03-13', NULL, 72, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (69.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_28 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:25', 0, 72, 1, 'member_28 @abc.com', 'e33956c9f7847a27c807b4724769f7df', 'member_28 ', '2012-03-13 09:36:25')[0m
  [1m[35mSQL (56.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 36)[0m
  [1m[35mSQL (46.3ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (36, 4)[0m
  [1m[35mSQL (46.7ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:25', 'ad_party1\'s address', 0, '2012-03-13 09:36:25', 'ad_party1', '12345678', 72, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:25', '2012-03-13 09:36:25', '2013-03-13', NULL, 73, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:25', 'ad_party2\'s address', 1, '2012-03-13 09:36:25', 'ad_party2', '12345678', 72, 0, NULL, 0, 0)
  [1m[36mSQL (43.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:26', '2012-03-13 09:36:26', '2013-03-13', NULL, 74, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (49.0ms)[0m  COMMIT
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1[0m
  Processing by PartiesController#new as HTML
Geokit is using the domain: test.host
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 1 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )[0m
check_result is false
Redirected to http://test.host/
Completed 302 Found in 5ms
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_47') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:26', 'Party_47\'s address', 0, '2012-03-13 09:36:26', 'Party_47', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:26', '2012-03-13 09:36:26', '2013-03-13', NULL, 75, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_29 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:26', 0, 75, 1, 'member_29 @abc.com', '1861e8940635ede293490579230b5956', 'member_29 ', '2012-03-13 09:36:26')[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 37)[0m
  [1m[35mSQL (46.1ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (37, 4)[0m
  [1m[35mSQL (46.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:26', 'ad_party1\'s address', 0, '2012-03-13 09:36:26', 'ad_party1', '12345678', 75, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:26', '2012-03-13 09:36:26', '2013-03-13', NULL, 76, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:26', 'ad_party2\'s address', 1, '2012-03-13 09:36:26', 'ad_party2', '12345678', 75, 0, NULL, 0, 0)
  [1m[36mSQL (43.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:26', '2012-03-13 09:36:26', '2013-03-13', NULL, 77, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 2 LIMIT 1[0m
  Processing by PartiesController#index as HTML
Geokit is using the domain: test.host
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 2 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1[0m
  [1m[35mParty Load (1.6ms)[0m  SELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 3)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0
Rendered parties/_party.html.erb (0.0ms)
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.5ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (0.4ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 3) LIMIT 1[0m
Rendered _page_head.html.erb (12.7ms)
Rendered side_bar/_agent.html.erb (0.7ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 26ms (Views: 18.3ms | ActiveRecord: 1718.6ms)
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_48') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:26', 'Party_48\'s address', 0, '2012-03-13 09:36:26', 'Party_48', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:26', '2012-03-13 09:36:26', '2013-03-13', NULL, 78, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_30 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:26', 0, 78, 1, 'member_30 @abc.com', '1bad3715cc4409122c89725d565b3970', 'member_30 ', '2012-03-13 09:36:26')[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 38)[0m
  [1m[35mSQL (46.4ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (38, 4)[0m
  [1m[35mSQL (68.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:27', 'ad_party1\'s address', 0, '2012-03-13 09:36:27', 'ad_party1', '12345678', 78, 0, NULL, 0, 0)[0m
  [1m[35mSQL (58.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:27', '2012-03-13 09:36:27', '2013-03-13', NULL, 79, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:27', 'ad_party2\'s address', 1, '2012-03-13 09:36:27', 'ad_party2', '12345678', 78, 0, NULL, 0, 0)
  [1m[36mSQL (67.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:27', '2012-03-13 09:36:27', '2013-03-13', NULL, 80, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (57.1ms)[0m  COMMIT
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  Processing by PartiesController#edit as HTML
  Parameters: {"id"=>#<Party id: 4, agent_id: nil, party_type: nil, adhub_operator: false, name: "Agent", address: nil, phone_number: nil, post_code: nil, created_at: "2012-03-13 09:36:26", updated_at: "2012-03-13 09:36:26", sales_id: nil, ad_maintained_by: 0, archived: false>}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 1 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )[0m
check_result is false
Redirected to http://test.host/
Completed 302 Found in 5ms
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_49') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:27', 'Party_49\'s address', 0, '2012-03-13 09:36:27', 'Party_49', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:27', '2012-03-13 09:36:27', '2013-03-13', NULL, 81, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_31 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:27', 0, 81, 1, 'member_31 @abc.com', 'd35f3f4b3824bd56101e0345034aa5c3', 'member_31 ', '2012-03-13 09:36:27')[0m
  [1m[35mSQL (44.3ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (39, 1)[0m
  [1m[35mSQL (46.5ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (39, 4)[0m
  [1m[35mSQL (46.5ms)[0m  COMMIT
  [1m[36mSQL (0.2ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.6ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.4ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:27', 'ad_party1\'s address', 0, '2012-03-13 09:36:27', 'ad_party1', '12345678', 81, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:27', '2012-03-13 09:36:27', '2013-03-13', NULL, 82, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:27', 'ad_party2\'s address', 1, '2012-03-13 09:36:27', 'ad_party2', '12345678', 81, 0, NULL, 0, 0)
  [1m[36mSQL (43.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:27', '2012-03-13 09:36:27', '2013-03-13', NULL, 83, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mMember Load (0.3ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1
  Processing by PartiesController#edit as HTML
  Parameters: {"id"=>#<Party id: 2, agent_id: nil, party_type: nil, adhub_operator: false, name: "Publisher", address: nil, phone_number: nil, post_code: nil, created_at: "2012-03-13 09:36:27", updated_at: "2012-03-13 09:36:27", sales_id: nil, ad_maintained_by: 0, archived: false>}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1[0m
  [1m[35mParty Load (0.0ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 1 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )[0m
check_result is true
Rendered parties/_f.html.erb (1.8ms)
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (1.5ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 2) LIMIT 1[0m
Rendered _page_head.html.erb (103.1ms)
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )
Rendered side_bar/_my_company.html.erb (3.7ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 141ms (Views: 134.3ms | ActiveRecord: 1007.6ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_50') LIMIT 1
  [1m[36mAREL (0.5ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:28', 'Party_50\'s address', 0, '2012-03-13 09:36:28', 'Party_50', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (1, '2012-03-13', '2012-03-13 09:36:28', '2012-03-13 09:36:28', '2013-03-13', NULL, 84, '123456', 0, 'person', NULL)
  [1m[36mSQL (44.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_32 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:28', 0, 84, 1, 'member_32 @abc.com', '88a360fe15f289e32130bf10fe82002b', 'member_32 ', '2012-03-13 09:36:28')
  [1m[36mSQL (43.9ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 40)
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 40)
  [1m[36mSQL (47.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:28', 'ad_party1\'s address', 0, '2012-03-13 09:36:28', 'ad_party1', '12345678', 84, 0, NULL, 0, 0)
  [1m[36mSQL (43.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:28', '2012-03-13 09:36:28', '2013-03-13', NULL, 85, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:28', 'ad_party2\'s address', 1, '2012-03-13 09:36:28', 'ad_party2', '12345678', 84, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:28', '2012-03-13 09:36:28', '2013-03-13', NULL, 86, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.1ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (1.0ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  Processing by PartiesController#create as HTML
  Parameters: {"party"=>{"party_type"=>1, "address"=>"add", "post_code"=>"123456", "name"=>"test", "phone_number"=>"123"}, "contract"=>{"contact_person"=>"abc", "start_from"=>"2012-01-01", "expired_at"=>"2013-03-13", "mobile_phone"=>"123"}}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
check_result is true
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'test') LIMIT 1
  [1m[36mAREL (48.5ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:28', 'add', 0, '2012-03-13 09:36:28', 'test', '123', 4, 0, NULL, 1, 0)[0m
  [1m[35mAREL (0.3ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-01-01', '2012-03-13 09:36:28', '2012-03-13 09:36:28', '2013-03-13', NULL, 87, '123', 0, 'abc', NULL)
Redirected to http://test.host/parties.html
  [1m[36mSQL (67.7ms)[0m  [1mCOMMIT[0m
Completed 302 Found in 128ms
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 2 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 5 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1
  [1m[36mRole Load (0.3ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 2 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 2 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1
  [1m[36mRole Load (0.3ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 2 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.4ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1
  [1m[36mParty Load (0.4ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mRole Load (0.4ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )
  [1m[36mSQL (1.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 5 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 1 )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 6 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 6 )
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 5 LIMIT 1[0m
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:29', '2012-03-13 09:36:29', 'channel1', 'channel1')[0m
  [1m[35mSQL (46.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:29', '2012-03-13 09:36:29', 'channel2', 'channel2')
  [1m[36mSQL (46.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_51') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:30', 'Party_51\'s address', 0, '2012-03-13 09:36:30', 'Party_51', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:30', '2012-03-13 09:36:30', '2013-03-13', NULL, 88, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_52') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:30', 'Party_52\'s address', 0, '2012-03-13 09:36:30', 'Party_52', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:30', '2012-03-13 09:36:30', '2013-03-13', NULL, 89, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_33 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:30', 0, 88, 1, 'member_33 @abc.com', '83ef1bc9b2f370872c32faf90ad90732', 'member_33 ', '2012-03-13 09:36:30')
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (41, 2)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_34 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:30', 0, 89, 1, 'member_34 @abc.com', 'cf7f9e59dcacafe5d21955ffd435a139', 'member_34 ', '2012-03-13 09:36:30')
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (2, 42)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 88 AND (`ad_containers`.`name` = BINARY 'ad_container1') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = '8KCMUCKadR3RoKPcnrdX'
  [1m[36mSQL (0.6ms)[0m  [1mdescribe `ad_containers`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, '8KCMUCKadR3RoKPcnrdX', 0.0, NULL, 0, '2012-03-13 09:36:30', 417882968, '2012-03-13 09:36:30', 1, 'ad_container1', NULL, 88, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 88) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (70.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 88 AND (`ad_containers`.`name` = BINARY 'ad_container2') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'o5PjKUzd27L1nuEBTWts'[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'o5PjKUzd27L1nuEBTWts', 0.0, NULL, 0, '2012-03-13 09:36:30', 417882968, '2012-03-13 09:36:30', 1, 'ad_container2', NULL, 88, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 88) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (54.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 88 AND (`ad_containers`.`name` = BINARY 'ad_container3') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'c4b4H9N7MbsrQXWFn22u'[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'c4b4H9N7MbsrQXWFn22u', 0.0, NULL, 0, '2012-03-13 09:36:30', 417882968, '2012-03-13 09:36:30', 1, 'ad_container3', NULL, 88, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 88) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (55.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 89 AND (`ad_containers`.`name` = BINARY 'AdContainer_6') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'rDtbavJRHHC2EqfOGTml'[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'rDtbavJRHHC2EqfOGTml', 0.0, NULL, 0, '2012-03-13 09:36:30', 417882968, '2012-03-13 09:36:30', 1, 'AdContainer_6', NULL, 89, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 89) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (53.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_53') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:30', 'Party_53\'s address', 0, '2012-03-13 09:36:30', 'Party_53', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_54') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:30', 'Party_54\'s address', 0, '2012-03-13 09:36:30', 'Party_54', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:30', '2012-03-13 09:36:30', '2013-03-13', NULL, 91, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:30', '2012-03-13 09:36:30', '2013-03-13', NULL, 90, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_35 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:30', 0, 90, 1, 'member_35 @abc.com', '125149f299ecf52a3fdac5c18e8eb002', 'member_35 ', '2012-03-13 09:36:30')[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'ad_owner' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (43, 3)[0m
  [1m[35mSQL (46.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement1', 'http://www.ad.com/advertisement1', 'icon_text', 0, '2012-03-13 09:36:30', 1, 0, 90, '2012-03-13 09:36:30', 2, 0, 0)
  [1m[36mSQL (45.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement2', 'http://www.ad.com/advertisement2', 'icon_text', 0, '2012-03-13 09:36:30', 1, 0, 91, '2012-03-13 09:36:30', 2, 0, 0)[0m
  [1m[35mSQL (45.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_55') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:31', 'Party_55\'s address', 0, '2012-03-13 09:36:31', 'Party_55', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:31', 'Campaign_7', '2012-04-13', '2012-03-13 09:36:31', '2012-03-13', 0.0, 92, 1000.0, 'desc')
  [1m[36mSQL (45.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:31', '2012-03-13 09:36:31', 1, 'pm_7', 1)[0m
  [1m[35mSQL (45.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_7', '2012-03-13 09:36:31', 10.0, 9, 100.0, 3, 0.0, '2012-03-13', 417882968, 11, '2012-02-13 09:36:31', 9, 1, NULL, 'url', '2012-03-13 09:36:31')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (18.9ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_56') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:31', 'Party_56\'s address', 0, '2012-03-13 09:36:31', 'Party_56', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:31', 'Campaign_8', '2012-04-13', '2012-03-13 09:36:31', '2012-03-13', 0.0, 93, 1000.0, 'desc')[0m
  [1m[35mSQL (45.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:31', '2012-03-13 09:36:31', 1, 'pm_8', 1)
  [1m[36mSQL (45.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_8', '2012-03-13 09:36:31', 10.0, 10, 100.0, 3, 0.0, '2012-03-13', 417882968, 11, '2012-03-13 09:36:31', 10, 1, NULL, 'url', '2012-03-13 09:36:31')[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:31', '2012-03-13 09:36:31', 'channel1', 'channel1')
  [1m[36mSQL (33.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:31', '2012-03-13 09:36:31', 'channel2', 'channel2')[0m
  [1m[35mSQL (34.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_57') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:31', 'Party_57\'s address', 0, '2012-03-13 09:36:31', 'Party_57', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (31.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:31', '2012-03-13 09:36:31', '2013-03-13', NULL, 94, '123456', 0, 'person', NULL)
  [1m[36mSQL (32.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_58') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:31', 'Party_58\'s address', 0, '2012-03-13 09:36:31', 'Party_58', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (31.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:31', '2012-03-13 09:36:31', '2013-03-13', NULL, 95, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (33.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_36 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:31', 0, 94, 1, 'member_36 @abc.com', '323982b73c82c2f0a575d9d1220035e0', 'member_36 ', '2012-03-13 09:36:31')[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (2, 44)[0m
  [1m[35mSQL (46.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_37 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:31', 0, 95, 1, 'member_37 @abc.com', 'fca074061f518cd78aacdeb0232fe0ab', 'member_37 ', '2012-03-13 09:36:31')[0m
  [1m[35mSQL (56.0ms)[0m  COMMIT
  [1m[36mRole Load (0.1ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (2, 45)[0m
  [1m[35mSQL (70.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 94 AND (`ad_containers`.`name` = BINARY 'ad_container1') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'OXHwRYCxenGT5oBy21tt'[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'OXHwRYCxenGT5oBy21tt', 0.0, NULL, 0, '2012-03-13 09:36:32', 417882970, '2012-03-13 09:36:32', 1, 'ad_container1', NULL, 94, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 94) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (77.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 94 AND (`ad_containers`.`name` = BINARY 'ad_container2') LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'CkUpeVKSzPNLQGeYWrhk'[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'CkUpeVKSzPNLQGeYWrhk', 0.0, NULL, 0, '2012-03-13 09:36:32', 417882970, '2012-03-13 09:36:32', 1, 'ad_container2', NULL, 94, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.5ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 94) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (76.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 94 AND (`ad_containers`.`name` = BINARY 'ad_container3') LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'IeT7NfIY90smystNEaKK'[0m
  [1m[35mAREL (0.8ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'IeT7NfIY90smystNEaKK', 0.0, NULL, 0, '2012-03-13 09:36:32', 417882970, '2012-03-13 09:36:32', 1, 'ad_container3', NULL, 94, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 94) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (86.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.3ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 95 AND (`ad_containers`.`name` = BINARY 'AdContainer_7') LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'Zp874LWRl7PSmFT878lK'[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'Zp874LWRl7PSmFT878lK', 0.0, NULL, 0, '2012-03-13 09:36:32', 417882970, '2012-03-13 09:36:32', 1, 'AdContainer_7', NULL, 95, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 95) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (75.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_59') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:32', 'Party_59\'s address', 0, '2012-03-13 09:36:32', 'Party_59', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_60') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:32', 'Party_60\'s address', 0, '2012-03-13 09:36:32', 'Party_60', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:32', '2012-03-13 09:36:32', '2013-03-13', NULL, 97, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:32', '2012-03-13 09:36:32', '2013-03-13', NULL, 96, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_38 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:32', 0, 96, 1, 'member_38 @abc.com', 'd4b5232cfab32ac6338136358b302c69', 'member_38 ', '2012-03-13 09:36:32')[0m
  [1m[35mSQL (44.4ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'ad_owner' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (3, 46)[0m
  [1m[35mSQL (46.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement1', 'http://www.ad.com/advertisement1', 'icon_text', 0, '2012-03-13 09:36:32', 1, 0, 96, '2012-03-13 09:36:32', 2, 0, 0)
  [1m[36mSQL (45.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement2', 'http://www.ad.com/advertisement2', 'icon_text', 0, '2012-03-13 09:36:32', 1, 0, 97, '2012-03-13 09:36:32', 2, 0, 0)[0m
  [1m[35mSQL (46.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_61') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:32', 'Party_61\'s address', 0, '2012-03-13 09:36:32', 'Party_61', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:32', 'Campaign_9', '2012-04-13', '2012-03-13 09:36:32', '2012-03-13', 0.0, 98, 1000.0, 'desc')
  [1m[36mSQL (45.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.5ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:32', '2012-03-13 09:36:32', 1, 'pm_9', 1)[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_9', '2012-03-13 09:36:32', 10.0, 11, 100.0, 3, 0.0, '2012-03-13', 417882970, 13, '2012-04-13', 11, 1, NULL, 'url', '2012-03-13 09:36:32')
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_62') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:32', 'Party_62\'s address', 0, '2012-03-13 09:36:32', 'Party_62', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:33', 'Campaign_10', '2012-04-13', '2012-03-13 09:36:33', '2012-03-13', 0.0, 99, 1000.0, 'desc')[0m
  [1m[35mSQL (45.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:33', '2012-03-13 09:36:33', 1, 'pm_10', 1)
  [1m[36mSQL (45.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_10', '2012-03-13 09:36:33', 10.0, 12, 100.0, 3, 0.0, '2012-03-13', 417882970, 13, '2012-04-13', 12, 1, NULL, 'url', '2012-03-13 09:36:33')[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:33', '2012-03-13 09:36:33', 'channel1', 'channel1')
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:33', '2012-03-13 09:36:33', 'channel2', 'channel2')[0m
  [1m[35mSQL (46.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_63') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:33', 'Party_63\'s address', 0, '2012-03-13 09:36:33', 'Party_63', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:33', '2012-03-13 09:36:33', '2013-03-13', NULL, 100, '123456', 0, 'person', NULL)
  [1m[36mSQL (56.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_64') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:33', 'Party_64\'s address', 0, '2012-03-13 09:36:33', 'Party_64', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (56.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:33', '2012-03-13 09:36:33', '2013-03-13', NULL, 101, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (57.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_39 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:33', 0, 100, 1, 'member_39 @abc.com', '69f93c1e587e8b7d3834a3c761ab7b5b', 'member_39 ', '2012-03-13 09:36:33')[0m
  [1m[35mSQL (56.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (2, 47)[0m
  [1m[35mSQL (58.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_40 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:33', 0, 101, 1, 'member_40 @abc.com', '4272a3c7cc50395cd9ac7061a2afdb1b', 'member_40 ', '2012-03-13 09:36:33')[0m
  [1m[35mSQL (44.3ms)[0m  COMMIT
  [1m[36mRole Load (0.1ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (48, 2)[0m
  [1m[35mSQL (34.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 100 AND (`ad_containers`.`name` = BINARY 'ad_container1') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'TJrUbnPAcDEGGPpN0kJp'[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'TJrUbnPAcDEGGPpN0kJp', 0.0, NULL, 0, '2012-03-13 09:36:33', 417882972, '2012-03-13 09:36:33', 1, 'ad_container1', NULL, 100, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 100) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (53.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 100 AND (`ad_containers`.`name` = BINARY 'ad_container2') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'ESY8BwLWzr2eTSHZYEIy'[0m
  [1m[35mAREL (0.3ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'ESY8BwLWzr2eTSHZYEIy', 0.0, NULL, 0, '2012-03-13 09:36:33', 417882972, '2012-03-13 09:36:33', 1, 'ad_container2', NULL, 100, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 100) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (53.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 100 AND (`ad_containers`.`name` = BINARY 'ad_container3') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'CQXK1noshecA87ZPSlPt'[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'CQXK1noshecA87ZPSlPt', 0.0, NULL, 0, '2012-03-13 09:36:33', 417882972, '2012-03-13 09:36:33', 1, 'ad_container3', NULL, 100, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 100) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (78.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 101 AND (`ad_containers`.`name` = BINARY 'AdContainer_8') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'ImofeSHINPeHnJVIO4R3'[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'ImofeSHINPeHnJVIO4R3', 0.0, NULL, 0, '2012-03-13 09:36:34', 417882972, '2012-03-13 09:36:34', 1, 'AdContainer_8', NULL, 101, NULL, NULL, 0, 0, 'desc')
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 101) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (77.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_65') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:34', 'Party_65\'s address', 0, '2012-03-13 09:36:34', 'Party_65', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (68.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_66') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:34', 'Party_66\'s address', 0, '2012-03-13 09:36:34', 'Party_66', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (67.9ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:34', '2012-03-13 09:36:34', '2013-03-13', NULL, 103, '123456', 0, 'person', NULL)
  [1m[36mSQL (57.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:34', '2012-03-13 09:36:34', '2013-03-13', NULL, 102, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_41 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:34', 0, 102, 1, 'member_41 @abc.com', '4e1075e9858780a6efc28095f8fc4776', 'member_41 ', '2012-03-13 09:36:34')[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'ad_owner' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (3, 49)[0m
  [1m[35mSQL (46.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement1', 'http://www.ad.com/advertisement1', 'icon_text', 0, '2012-03-13 09:36:34', 1, 0, 102, '2012-03-13 09:36:34', 2, 0, 0)
  [1m[36mSQL (45.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement2', 'http://www.ad.com/advertisement2', 'icon_text', 0, '2012-03-13 09:36:34', 1, 0, 103, '2012-03-13 09:36:34', 2, 0, 0)[0m
  [1m[35mSQL (45.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_67') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:34', 'Party_67\'s address', 0, '2012-03-13 09:36:34', 'Party_67', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (40.8ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:34', 'Campaign_11', '2012-04-13', '2012-03-13 09:36:34', '2012-03-13', 0.0, 104, 1000.0, 'desc')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:34', '2012-03-13 09:36:34', 1, 'pm_11', 1)[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_11', '2012-03-13 09:36:34', 10.0, 13, 100.0, 3, 0.0, '2012-03-13', 417882973, 15, '2012-04-13', 13, 1, NULL, 'url', '2012-03-13 09:36:34')
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `ad_containers_publish_policies` (`ad_container_id`, `publish_policy_id`) VALUES (298258282, 13)[0m
  [1m[35mSQL (46.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_68') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:34', 'Party_68\'s address', 0, '2012-03-13 09:36:34', 'Party_68', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (42.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:34', 'Campaign_12', '2012-04-13', '2012-03-13 09:36:34', '2012-03-13', 0.0, 105, 1000.0, 'desc')
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:34', '2012-03-13 09:36:34', 1, 'pm_12', 1)[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_12', '2012-03-13 09:36:35', 10.0, 14, 100.0, 3, 0.0, '2012-03-13', 417882973, 15, '2012-04-13', 14, 1, NULL, 'url', '2012-03-13 09:36:35')
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:35', '2012-03-13 09:36:35', 'channel1', 'channel1')[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:35', '2012-03-13 09:36:35', 'channel2', 'channel2')
  [1m[36mSQL (47.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_69') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:35', 'Party_69\'s address', 0, '2012-03-13 09:36:35', 'Party_69', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:35', '2012-03-13 09:36:35', '2013-03-13', NULL, 106, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (44.8ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_70') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:35', 'Party_70\'s address', 0, '2012-03-13 09:36:35', 'Party_70', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:35', '2012-03-13 09:36:35', '2013-03-13', NULL, 107, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_42 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:35', 0, 106, 1, 'member_42 @abc.com', 'c520ee362d52116fcbe8c437946fdbbf', 'member_42 ', '2012-03-13 09:36:35')
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (50, 2)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_43 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:35', 0, 107, 1, 'member_43 @abc.com', '6cc8ee10cbdb7e838966fb1417875625', 'member_43 ', '2012-03-13 09:36:35')
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.1ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (51, 2)
  [1m[36mSQL (46.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 106 AND (`ad_containers`.`name` = BINARY 'ad_container1') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = '5hnK4g5XR32Hk23sV7FA'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, '5hnK4g5XR32Hk23sV7FA', 0.0, NULL, 0, '2012-03-13 09:36:35', 417882974, '2012-03-13 09:36:35', 1, 'ad_container1', NULL, 106, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 106) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (53.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 106 AND (`ad_containers`.`name` = BINARY 'ad_container2') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'UM23wDCOlGhABeY5qofs'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'UM23wDCOlGhABeY5qofs', 0.0, NULL, 0, '2012-03-13 09:36:35', 417882974, '2012-03-13 09:36:35', 1, 'ad_container2', NULL, 106, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 106) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (53.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 106 AND (`ad_containers`.`name` = BINARY 'ad_container3') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'KBKoudtOkTq0LzJFkdrB'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'KBKoudtOkTq0LzJFkdrB', 0.0, NULL, 0, '2012-03-13 09:36:35', 417882974, '2012-03-13 09:36:35', 1, 'ad_container3', NULL, 106, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 106) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (41.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 107 AND (`ad_containers`.`name` = BINARY 'AdContainer_9') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = '8RAqL206nHoQUeIiciMx'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, '8RAqL206nHoQUeIiciMx', 0.0, NULL, 0, '2012-03-13 09:36:35', 417882974, '2012-03-13 09:36:35', 1, 'AdContainer_9', NULL, 107, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 107) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (53.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_71') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:35', 'Party_71\'s address', 0, '2012-03-13 09:36:35', 'Party_71', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_72') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:35', 'Party_72\'s address', 0, '2012-03-13 09:36:35', 'Party_72', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:36', '2012-03-13 09:36:36', '2013-03-13', NULL, 109, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:36', '2012-03-13 09:36:36', '2013-03-13', NULL, 108, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_44 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:36', 0, 108, 1, 'member_44 @abc.com', '24c3585437dc7a76e2a329631597b266', 'member_44 ', '2012-03-13 09:36:36')
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'ad_owner' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (52, 3)
  [1m[36mSQL (46.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement1', 'http://www.ad.com/advertisement1', 'icon_text', 0, '2012-03-13 09:36:36', 1, 0, 108, '2012-03-13 09:36:36', 2, 0, 0)[0m
  [1m[35mSQL (45.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement2', 'http://www.ad.com/advertisement2', 'icon_text', 0, '2012-03-13 09:36:36', 1, 0, 109, '2012-03-13 09:36:36', 2, 0, 0)
  [1m[36mSQL (45.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('iphone', 'http://www.ad.com/iphone', 'icon_text', 0, '2012-03-13 09:36:36', 1, 0, 108, '2012-03-13 09:36:36', 2, 0, 0)[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('ipad', 'http://www.ad.com/ipad', 'icon_text', 0, '2012-03-13 09:36:36', 1, 0, 108, '2012-03-13 09:36:36', 2, 0, 0)
  [1m[36mSQL (45.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_73') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:36', 'Party_73\'s address', 0, '2012-03-13 09:36:36', 'Party_73', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (43.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:36', 'Campaign_13', '2012-04-13', '2012-03-13 09:36:36', '2012-03-13', 0.0, 110, 1000.0, 'desc')[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:36', '2012-03-13 09:36:36', 1, 'pm_13', 1)
  [1m[36mSQL (45.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_13', '2012-03-13 09:36:36', 10.0, 15, 100.0, 3, 0.0, '2012-03-13', 417882974, 19, '2012-04-13', 15, 1, NULL, 'url', '2012-03-13 09:36:36')[0m
  [1m[35mSQL (45.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_74') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:36', 'Party_74\'s address', 0, '2012-03-13 09:36:36', 'Party_74', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:36', 'Campaign_14', '2012-04-13', '2012-03-13 09:36:36', '2012-03-13', 0.0, 111, 1000.0, 'desc')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:36', '2012-03-13 09:36:36', 1, 'pm_14', 1)[0m
  [1m[35mSQL (45.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_14', '2012-03-13 09:36:36', 10.0, 16, 100.0, 3, 0.0, '2012-03-13', 417882974, 20, '2012-04-13', 16, 1, NULL, 'url', '2012-03-13 09:36:36')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:36', '2012-03-13 09:36:36', 'channel1', 'channel1')[0m
  [1m[35mSQL (46.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:36', '2012-03-13 09:36:36', 'channel2', 'channel2')
  [1m[36mSQL (46.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_75') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:36', 'Party_75\'s address', 0, '2012-03-13 09:36:36', 'Party_75', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:37', '2012-03-13 09:36:37', '2013-03-13', NULL, 112, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (57.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_76') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:37', 'Party_76\'s address', 0, '2012-03-13 09:36:37', 'Party_76', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (44.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:37', '2012-03-13 09:36:37', '2013-03-13', NULL, 113, '123456', 0, 'person', NULL)
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_45 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:37', 0, 112, 1, 'member_45 @abc.com', '8952a24a9d1a2378c4de2757e6bd779a', 'member_45 ', '2012-03-13 09:36:37')
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (2, 53)
  [1m[36mSQL (46.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_46 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:37', 0, 113, 1, 'member_46 @abc.com', 'fdc772c08c2320d81c06ee4698418ac0', 'member_46 ', '2012-03-13 09:36:37')
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.1ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (2, 54)
  [1m[36mSQL (46.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 112 AND (`ad_containers`.`name` = BINARY 'ad_container1') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'Tbb2H8N4joeYSKC8doB5'
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'Tbb2H8N4joeYSKC8doB5', 0.0, NULL, 0, '2012-03-13 09:36:37', 417882976, '2012-03-13 09:36:37', 1, 'ad_container1', NULL, 112, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 112) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (66.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 112 AND (`ad_containers`.`name` = BINARY 'ad_container2') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'tWWCgu46cE3OxKCmvfUT'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'tWWCgu46cE3OxKCmvfUT', 0.0, NULL, 0, '2012-03-13 09:36:37', 417882976, '2012-03-13 09:36:37', 1, 'ad_container2', NULL, 112, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 112) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (42.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 112 AND (`ad_containers`.`name` = BINARY 'ad_container3') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'kkqAskYiiBsWWtgwCobC'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'kkqAskYiiBsWWtgwCobC', 0.0, NULL, 0, '2012-03-13 09:36:37', 417882976, '2012-03-13 09:36:37', 1, 'ad_container3', NULL, 112, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 112) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (53.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 113 AND (`ad_containers`.`name` = BINARY 'AdContainer_10') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'NyAjUhanjGMzTkOHf88y'
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'NyAjUhanjGMzTkOHf88y', 0.0, NULL, 0, '2012-03-13 09:36:37', 417882976, '2012-03-13 09:36:37', 1, 'AdContainer_10', NULL, 113, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 113) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (53.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_77') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:37', 'Party_77\'s address', 0, '2012-03-13 09:36:37', 'Party_77', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (19.5ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_78') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:37', 'Party_78\'s address', 0, '2012-03-13 09:36:37', 'Party_78', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (40.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:37', '2012-03-13 09:36:37', '2013-03-13', NULL, 115, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (32.9ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:37', '2012-03-13 09:36:37', '2013-03-13', NULL, 114, '123456', 0, 'person', NULL)
  [1m[36mSQL (32.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_47 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:37', 0, 114, 1, 'member_47 @abc.com', 'ca4538034b84d234a836c7167e704947', 'member_47 ', '2012-03-13 09:36:37')
  [1m[36mSQL (31.7ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'ad_owner' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (55, 3)
  [1m[36mSQL (34.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement1', 'http://www.ad.com/advertisement1', 'icon_text', 0, '2012-03-13 09:36:37', 1, 0, 114, '2012-03-13 09:36:37', 2, 0, 0)[0m
  [1m[35mSQL (80.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement2', 'http://www.ad.com/advertisement2', 'icon_text', 0, '2012-03-13 09:36:38', 1, 0, 115, '2012-03-13 09:36:38', 2, 0, 0)
  [1m[36mSQL (57.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_79') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:38', 'Party_79\'s address', 0, '2012-03-13 09:36:38', 'Party_79', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (54.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:38', 'Campaign_15', '2012-04-13', '2012-03-13 09:36:38', '2012-03-13', 0.0, 116, 1000.0, 'desc')[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:38', '2012-03-13 09:36:38', 1, 'pm_15', 1)
  [1m[36mSQL (57.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_15', '2012-03-13 09:36:38', 10.0, 17, 100.0, 3, 0.0, '2012-03-13', 417882976, 21, '2012-04-13', 17, 1, NULL, 'url', '2012-03-13 09:36:38')[0m
  [1m[35mSQL (57.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_80') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:38', 'Party_80\'s address', 0, '2012-03-13 09:36:38', 'Party_80', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (54.8ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:38', 'Campaign_16', '2012-04-13', '2012-03-13 09:36:38', '2012-03-13', 0.0, 117, 1000.0, 'desc')
  [1m[36mSQL (93.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:38', '2012-03-13 09:36:38', 1, 'pm_16', 1)[0m
  [1m[35mSQL (69.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('PublishPolicy_16', '2012-03-13 09:36:38', 10.0, 18, 100.0, 3, 0.0, '2012-03-13', 417882977, 21, '2012-04-13', 18, 1, NULL, 'url', '2012-03-13 09:36:38')
  [1m[36mSQL (69.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:38', '2012-03-13 09:36:38', 'channel1', 'channel1')[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `channels` (`created_at`, `updated_at`, `ad_container_name`, `name`) VALUES ('2012-03-13 09:36:38', '2012-03-13 09:36:38', 'channel2', 'channel2')
  [1m[36mSQL (70.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_81') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:38', 'Party_81\'s address', 0, '2012-03-13 09:36:38', 'Party_81', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (68.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:38', '2012-03-13 09:36:38', '2013-03-13', NULL, 118, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (57.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_82') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:38', 'Party_82\'s address', 0, '2012-03-13 09:36:38', 'Party_82', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (55.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (0, '2012-03-13', '2012-03-13 09:36:39', '2012-03-13 09:36:39', '2013-03-13', NULL, 119, '123456', 0, 'person', NULL)
  [1m[36mSQL (69.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_48 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:39', 0, 118, 1, 'member_48 @abc.com', '090dba682976c0230f6d1a63e963dac5', 'member_48 ', '2012-03-13 09:36:39')
  [1m[36mSQL (56.0ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (56, 2)
  [1m[36mSQL (46.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_49 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:39', 0, 119, 1, 'member_49 @abc.com', '85caff425ed20a39c83f6f1be0f8c453', 'member_49 ', '2012-03-13 09:36:39')
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.1ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'publisher' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (2, 57)
  [1m[36mSQL (94.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 118 AND (`ad_containers`.`name` = BINARY 'ad_container1') LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'MGHc2FotUgssTooIrsWQ'
  [1m[36mAREL (62.2ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'MGHc2FotUgssTooIrsWQ', 0.0, NULL, 0, '2012-03-13 09:36:39', 417882978, '2012-03-13 09:36:39', 1, 'ad_container1', NULL, 118, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 118) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (81.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.3ms)[0m  BEGIN
  [1m[36mSQL (0.4ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 118 AND (`ad_containers`.`name` = BINARY 'ad_container2') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'uAPSVkso5FpQ5iFg9P1g'
  [1m[36mAREL (114.4ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'uAPSVkso5FpQ5iFg9P1g', 0.0, NULL, 0, '2012-03-13 09:36:39', 417882978, '2012-03-13 09:36:39', 1, 'ad_container2', NULL, 118, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 118) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (82.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 118 AND (`ad_containers`.`name` = BINARY 'ad_container3') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'RMFBbIGjQ7CeNvo7dNft'
  [1m[36mAREL (49.6ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'RMFBbIGjQ7CeNvo7dNft', 0.0, NULL, 0, '2012-03-13 09:36:39', 417882978, '2012-03-13 09:36:39', 1, 'ad_container3', NULL, 118, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 118) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (58.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 119 AND (`ad_containers`.`name` = BINARY 'AdContainer_11') LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'IlIYzsa2crdTBAb4ur4n'
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`url`, `identity`, `income`, `latitude`, `show_count`, `created_at`, `channel_id`, `updated_at`, `status`, `name`, `longitude`, `party_id`, `type`, `os_type`, `request_count`, `click_count`, `description`) VALUES (NULL, 'IlIYzsa2crdTBAb4ur4n', 0.0, NULL, 0, '2012-03-13 09:36:39', 417882978, '2012-03-13 09:36:39', 1, 'AdContainer_11', NULL, 119, NULL, NULL, 0, 0, 'desc')[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 119) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (113.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_83') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:39', 'Party_83\'s address', 0, '2012-03-13 09:36:39', 'Party_83', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_84') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:40', 'Party_84\'s address', 0, '2012-03-13 09:36:40', 'Party_84', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (105.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:40', '2012-03-13 09:36:40', '2013-03-13', NULL, 121, '123456', 0, 'person', NULL)[0m
  [1m[35mSQL (105.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`business_type`, `start_from`, `updated_at`, `created_at`, `expired_at`, `share_rate_2`, `party_id`, `mobile_phone`, `expiration_processed`, `contact_person`, `share_rate_1`) VALUES (2, '2012-03-13', '2012-03-13 09:36:40', '2012-03-13 09:36:40', '2013-03-13', NULL, 120, '123456', 0, 'person', NULL)
  [1m[36mSQL (57.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_50 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`activation_code`, `password_hash`, `updated_at`, `is_admin`, `party_id`, `status`, `email`, `ha1`, `real_name`, `created_at`) VALUES (NULL, '5f4dcc3b5aa765d61d8327deb882cf99', '2012-03-13 09:36:40', 0, 120, 1, 'member_50 @abc.com', 'ba92e508a49d031a0ff8c4e2a3813852', 'member_50 ', '2012-03-13 09:36:40')
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'ad_owner' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (58, 3)
  [1m[36mSQL (34.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement1', 'http://www.ad.com/advertisement1', 'icon_text', 0, '2012-03-13 09:36:40', 1, 0, 120, '2012-03-13 09:36:40', 2, 0, 0)[0m
  [1m[35mSQL (33.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`name`, `content_url`, `ad_format`, `used_budget`, `created_at`, `owner_maintained`, `impression_count`, `party_id`, `updated_at`, `status`, `decimal`, `click_count`) VALUES ('advertisement2', 'http://www.ad.com/advertisement2', 'icon_text', 0, '2012-03-13 09:36:40', 1, 0, 121, '2012-03-13 09:36:40', 2, 0, 0)
  [1m[36mSQL (33.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_85') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:40', 'Party_85\'s address', 0, '2012-03-13 09:36:40', 'Party_85', '12345678', NULL, 0, NULL, 0, 0)
  [1m[36mSQL (31.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:40', 'Campaign_17', '2012-04-13', '2012-03-13 09:36:40', '2012-03-13', 0.0, 122, 1000.0, 'desc')[0m
  [1m[35mSQL (57.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:40', '2012-03-13 09:36:40', 1, 'pm_17', 1)
  [1m[36mSQL (57.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('policy1', '2012-03-13 09:36:40', 10.0, 19, 100.0, 3, 0.0, '2012-03-13', 417882978, 23, '2012-04-13', 19, 1, NULL, 'url', '2012-03-13 09:36:40')[0m
  [1m[35mSQL (69.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_86') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`post_code`, `updated_at`, `address`, `archived`, `created_at`, `name`, `phone_number`, `agent_id`, `ad_maintained_by`, `sales_id`, `party_type`, `adhub_operator`) VALUES ('123456', '2012-03-13 09:36:40', 'Party_86\'s address', 0, '2012-03-13 09:36:40', 'Party_86', '12345678', NULL, 0, NULL, 0, 0)[0m
  [1m[35mSQL (67.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `updated_at`, `name`, `end_to`, `created_at`, `start_from`, `used_budget`, `party_id`, `daily_budget`, `description`) VALUES (10000.0, '2012-03-13 09:36:40', 'Campaign_18', '2012-04-13', '2012-03-13 09:36:40', '2012-03-13', 0.0, 123, 1000.0, 'desc')
  [1m[36mSQL (57.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `pay_methods` (`effect_string`, `note`, `string`, `created_at`, `updated_at`, `unit`, `name`, `pay_on`) VALUES ('pm effect', 'pm note', NULL, '2012-03-13 09:36:40', '2012-03-13 09:36:40', 1, 'pm_18', 1)[0m
  [1m[35mSQL (45.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`name`, `updated_at`, `bid_price`, `pay_method_id`, `daily_budget`, `status`, `used_budget`, `start_from`, `channel_id`, `advertisement_id`, `end_to`, `campaign_id`, `step`, `call_to_action_params`, `call_to_action`, `created_at`) VALUES ('policy2', '2012-03-13 09:36:40', 10.0, 20, 100.0, 3, 0.0, '2012-03-13', 417882978, 23, '2012-04-13', 20, 1, NULL, 'url', '2012-03-13 09:36:40')
  [1m[36mSQL (45.1ms)[0m  [1mCOMMIT[0m
select main menu mnu_ad_owner
select main menu mnu_admin
select main menu mnu_agent
select main menu mnu_agent
select main menu mnu_my_account
select main menu mnu_my_company
select main menu mnu_my_company
select main menu mnu_publisher
  [1m[36mSQL (0.4ms)[0m  [1mdescribe `ad_containers_content_categories`[0m
  [1m[35mSQL (0.5ms)[0m  describe `ad_containers_publish_policies`
  [1m[36mSQL (0.5ms)[0m  [1mSHOW TABLES[0m
  [1m[35mSQL (0.4ms)[0m  describe `ad_containers_content_categories`
  [1m[36mSQL (0.4ms)[0m  [1mdescribe `members_roles`[0m
  [1m[35mSQL (0.4ms)[0m  describe `content_categories_publish_policies`
  [1m[36mSQL (0.4ms)[0m  [1mdescribe `ad_containers_publish_policies`[0m
Unable to load ad_containers_publish_policy, underlying cause No such file to load -- ad_containers_publish_policy 

 /var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:304:in `depend_on'
/var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:216:in `require_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:868:in `try_to_load_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:883:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `each'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:863:in `fixtures'
./test/test_helper.rb:10
./test/functional/publisher/reports_controller_test.rb:1:in `require'
./test/functional/publisher/reports_controller_test.rb:1
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load content_categories_publish_policy, underlying cause No such file to load -- content_categories_publish_policy 

 /var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:304:in `depend_on'
/var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:216:in `require_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:868:in `try_to_load_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:883:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `each'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:863:in `fixtures'
./test/test_helper.rb:10
./test/functional/publisher/reports_controller_test.rb:1:in `require'
./test/functional/publisher/reports_controller_test.rb:1
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
Unable to load members_role, underlying cause No such file to load -- members_role 

 /var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:304:in `depend_on'
/var/lib/gems/1.8/gems/activesupport-3.0.9/lib/active_support/dependencies.rb:216:in `require_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:868:in `try_to_load_dependency'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:883:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `each'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:880:in `require_fixture_classes'
/var/lib/gems/1.8/gems/activerecord-3.0.9/lib/active_record/fixtures.rb:863:in `fixtures'
./test/test_helper.rb:10
./test/functional/publisher/reports_controller_test.rb:1:in `require'
./test/functional/publisher/reports_controller_test.rb:1
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `load'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5:in `each'
/var/lib/gems/1.8/gems/rake-0.8.7/lib/rake/rake_test_loader.rb:5
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_1') LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  describe `parties`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_1', '2012-03-13 09:37:57', '2012-03-13 09:37:57', 'Party_1\'s address', '123456', 0)[0m
  [1m[35mSQL (49.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  describe `channels`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `name`, `ad_container_name`, `updated_at`) VALUES ('2012-03-13 09:37:57', 'Channe_1', 'Channe_1', '2012-03-13 09:37:57')[0m
  [1m[35mSQL (42.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 6 AND (`ad_containers`.`name` = BINARY 'AdContainer_1') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'LgcmORidcnNFnGpskSWE'[0m
  [1m[35mSQL (0.4ms)[0m  describe `ad_containers`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_containers` (`description`, `type`, `status`, `show_count`, `url`, `click_count`, `name`, `income`, `channel_id`, `updated_at`, `request_count`, `party_id`, `created_at`, `longitude`, `latitude`, `identity`, `os_type`) VALUES ('desc', 'Application', 1, 0, 'http://www.adhub.com/AdContainer_1', 0, 'AdContainer_1', 0.0, 417882963, '2012-03-13 09:37:57', 0, 6, '2012-03-13 09:37:57', NULL, NULL, 'LgcmORidcnNFnGpskSWE', 0)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 6) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (59.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_2', '2012-03-13 09:37:58', '2012-03-13 09:37:58', 'Party_2\'s address', '123456', 0)
  [1m[36mSQL (50.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mdescribe `pay_methods`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`created_at`, `note`, `pay_on`, `name`, `effect_string`, `string`, `updated_at`, `unit`) VALUES ('2012-03-13 09:37:58', 'pm note', 0, 'pm_1', 'pm effect', NULL, '2012-03-13 09:37:58', 1000)
  [1m[36mSQL (40.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_3') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_3', '2012-03-13 09:37:58', '2012-03-13 09:37:58', 'Party_3\'s address', '123456', 0)
  [1m[36mSQL (41.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.3ms)[0m  [1mdescribe `campaigns`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `campaigns` (`budget`, `created_at`, `start_from`, `description`, `daily_budget`, `used_budget`, `party_id`, `end_to`, `updated_at`, `name`) VALUES (10000.0, '2012-03-13 09:37:58', '2012-03-13', 'desc', 1000.0, 0.0, 8, '2012-04-13', '2012-03-13 09:37:58', 'Campaign_1')
  [1m[36mSQL (38.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.5ms)[0m  [1mdescribe `advertisements`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `advertisements` (`impression_count`, `ad_format`, `updated_at`, `created_at`, `party_id`, `owner_maintained`, `decimal`, `click_count`, `name`, `used_budget`, `status`, `content_url`) VALUES (0, 'icon_text', '2012-03-13 09:37:58', '2012-03-13 09:37:58', 8, 1, 0, 0, 'Ad_1', 0, 2, 'http://www.ad.com/Ad_1')
  [1m[36mSQL (43.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.4ms)[0m  [1mdescribe `publish_policies`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `publish_policies` (`step`, `status`, `daily_budget`, `used_budget`, `end_to`, `advertisement_id`, `campaign_id`, `bid_price`, `updated_at`, `call_to_action_params`, `pay_method_id`, `start_from`, `call_to_action`, `channel_id`, `name`, `created_at`) VALUES (1, 1, 100.0, 0.0, '2012-04-13', 5, 3, 10.0, '2012-03-13 09:37:58', NULL, 3, '2012-03-13', 'url', 417882963, 'PublishPolicy_1', '2012-03-13 09:37:58')
  [1m[36mSQL (41.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `publish_policies` SET `status` = 3, `updated_at` = '2012-03-13 09:37:58', `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 3[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 3 )
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 3 )[0m
  [1m[35mAdShowControl Load (0.2ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 3) LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mdescribe `ad_show_controls`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_show_controls` (`weight`, `unit_price`, `party_id`, `ad_format`, `campaign_id`, `created_at`, `size_codes`, `updated_at`, `channel_id`, `content_categories`, `advertisement_id`, `begin`, `end`, `ad_containers`, `publish_policy_id`) VALUES (1.0, 0.01, 8, 'icon_text', 3, '2012-03-13 09:37:58', NULL, '2012-03-13 09:37:58', 417882963, NULL, 5, '2012-03-13', '2012-04-13', NULL, 3)
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.6ms)[0m  [1mdescribe `contracts`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:37:58', '2012-03-13', 0, 0.9, 0.8, 6, '2012-03-13 09:37:58', '2013-03-13')
  [1m[36mSQL (50.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_4') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_4', '2012-03-13 09:37:58', '2012-03-13 09:37:58', 'Party_4\'s address', '123456', 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_1 @abc.com') LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  describe `members`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('f6b0a2fec25949ce2ad400e179b6aad8', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:37:58', 'member_1 @abc.com', 'member_1 ', '2012-03-13 09:37:58', 0, 9, NULL)[0m
  [1m[35mSQL (42.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.5ms)[0m  describe `ad_resources`
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:37:58', '2012-03-13 09:37:58', 'icon_text', 'square', 'icon_text_icon.jpg', 5, NULL, 7, 'image/jpeg', 'icon', 80, 80)[0m
  [1m[35mSQL (61.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_5') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_5', '2012-03-13 09:37:58', '2012-03-13 09:37:58', 'Party_5\'s address', '123456', 0)[0m
  [1m[35mSQL (30.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_2 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('3f34e6fc4eb5b412495a4528ab6068b2', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:37:58', 'member_2 @abc.com', 'member_2 ', '2012-03-13 09:37:58', 0, 10, NULL)[0m
  [1m[35mSQL (32.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:37:58', '2012-03-13 09:37:58', 'icon_text', NULL, NULL, 5, 'Text', 8, NULL, 'title', NULL, NULL)
  [1m[36mSQL (33.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_6') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_6', '2012-03-13 09:37:58', '2012-03-13 09:37:58', 'Party_6\'s address', '123456', 0)
  [1m[36mSQL (31.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_3 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('5a1df154d99a4aab5d10574ac72f881d', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:37:58', 'member_3 @abc.com', 'member_3 ', '2012-03-13 09:37:58', 0, 11, NULL)
  [1m[36mSQL (32.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:37:58', '2012-03-13 09:37:58', 'icon_text', NULL, NULL, 5, 'Text', 9, NULL, 'subtitle', NULL, NULL)[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 8) LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mdescribe `accounts`[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 8, '2012-03-13 09:37:58', '2012-03-13 09:37:58')
  [1m[36mSQL (42.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (49.1ms)[0m  update accounts set balance = balance + 1000 where id = 3
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 3 LIMIT 1[0m
  [1m[35mSQL (47.0ms)[0m  update accounts set balance = balance + 100 where id = 3
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 3 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_7') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_7', '2012-03-13 09:37:59', '2012-03-13 09:37:59', 'Party_7\'s address', '123456', 0)
  [1m[36mSQL (42.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `created_at`, `start_from`, `description`, `daily_budget`, `used_budget`, `party_id`, `end_to`, `updated_at`, `name`) VALUES (10000.0, '2012-03-13 09:37:59', '2012-03-13', 'desc', 1000.0, 0.0, 12, '2012-04-13', '2012-03-13 09:37:59', 'Campaign_2')[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`impression_count`, `ad_format`, `updated_at`, `created_at`, `party_id`, `owner_maintained`, `decimal`, `click_count`, `name`, `used_budget`, `status`, `content_url`) VALUES (0, 'icon_text', '2012-03-13 09:37:59', '2012-03-13 09:37:59', 12, 1, 0, 0, 'Ad_2', 0, 2, 'http://www.ad.com/Ad_2')
  [1m[36mSQL (45.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `pay_methods` (`created_at`, `note`, `pay_on`, `name`, `effect_string`, `string`, `updated_at`, `unit`) VALUES ('2012-03-13 09:37:59', 'pm note', 1, 'pm_2', 'pm effect', NULL, '2012-03-13 09:37:59', 1)[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `publish_policies` (`step`, `status`, `daily_budget`, `used_budget`, `end_to`, `advertisement_id`, `campaign_id`, `bid_price`, `updated_at`, `call_to_action_params`, `pay_method_id`, `start_from`, `call_to_action`, `channel_id`, `name`, `created_at`) VALUES (1, 1, 100.0, 0.0, '2012-04-13', 6, 4, 10.0, '2012-03-13 09:37:59', NULL, 4, '2012-03-13', 'url', 417882963, 'PublishPolicy_2', '2012-03-13 09:37:59')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `publish_policies` SET `status` = 3, `updated_at` = '2012-03-13 09:37:59', `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 4[0m
  [1m[35mSQL (0.4ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882963 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 4 )
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 4 )[0m
  [1m[35mAdShowControl Load (0.2ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 4) LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_show_controls` (`weight`, `unit_price`, `party_id`, `ad_format`, `campaign_id`, `created_at`, `size_codes`, `updated_at`, `channel_id`, `content_categories`, `advertisement_id`, `begin`, `end`, `ad_containers`, `publish_policy_id`) VALUES (1.0, 10.0, 12, 'icon_text', 4, '2012-03-13 09:37:59', NULL, '2012-03-13 09:37:59', 417882963, NULL, 6, '2012-03-13', '2012-04-13', NULL, 4)[0m
  [1m[35mSQL (48.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `publish_policies` SET `daily_budget` = 0.0, `updated_at` = '2012-03-13 09:37:59', `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 4
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  Processing by AdRequestsController#index as JSON
  Parameters: {"device"=>"mobile_phone", "size"=>"banner", "app"=>"LgcmORidcnNFnGpskSWE"}
Geokit is using the domain: test.host
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'LgcmORidcnNFnGpskSWE' LIMIT 1
found container #<Application:0xb52f6c18>
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 6 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 6) AND (expired_at >= '2012-03-13' )
  [1m[36mAdRequest Load (0.3ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258269 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.6ms)[0m  [1mdescribe `ad_requests`[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_requests` (`created_at`, `agent_id`, `publisher_id`, `fulfilled`, `advertisement_id`, `updated_at`, `publisher_share_rate`, `ip_address`, `pay_method_id`, `size_code`, `ad_owner_id`, `request_date`, `unit_price`, `publish_policy_id`, `agent_share_rate`, `ad_container_id`, `campaign_id`, `shown`, `clicked`, `paid`) VALUES ('2012-03-13 09:37:59', NULL, 6, 0, NULL, '2012-03-13 09:37:59', NULL, '0.0.0.0', NULL, 'banner', NULL, '2012-03-13', NULL, NULL, NULL, 298258269, NULL, 0, 0, 0)
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258269[0m
  [1m[35mSQL (45.5ms)[0m  COMMIT
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258269 )[0m
  [1m[35mAdShowControl Load (0.3ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882963) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258269\'%'))) ORDER BY weight * rand() desc LIMIT 1
  [1m[36mPublishPolicy Load (0.1ms)[0m  [1mSELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 4 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`publish_policy_id` = 4 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1
  [1m[36mAdShowControl Load (0.3ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882963) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258269\'%'))) and (not (id in (2)))) ORDER BY weight * rand() desc LIMIT 1[0m
  [1m[35mPublishPolicy Load (0.1ms)[0m  SELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 3 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`publish_policy_id` = 3 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1[0m
  [1m[35mCampaign Load (0.1ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 3 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`campaign_id` = 3 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 8 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 8) LIMIT 1[0m
  [1m[35mPayMethod Load (0.1ms)[0m  SELECT `pay_methods`.* FROM `pay_methods` WHERE `pay_methods`.`id` = 3 LIMIT 1
  [1m[36mAdvertisement Load (0.1ms)[0m  [1mSELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 5 LIMIT 1[0m
  [1m[35mCampaign Load (0.1ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 3 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 8 LIMIT 1[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 6) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `ad_requests` SET `fulfilled` = 1, `advertisement_id` = 5, `updated_at` = '2012-03-13 09:37:59', `publisher_share_rate` = 0.8, `pay_method_id` = 3, `ad_owner_id` = 8, `unit_price` = 0.01, `publish_policy_id` = 3, `agent_share_rate` = 0.0, `campaign_id` = 3 WHERE `ad_requests`.`id` = 980190963
  [1m[36mSQL (52.8ms)[0m  [1mCOMMIT[0m
  [1m[35mAdvertisement Load (0.1ms)[0m  SELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 5 LIMIT 1
advertisement = #<Advertisement:0xb523ad24>
  [1m[36mAdResource Load (0.2ms)[0m  [1mSELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'icon' AND (`ad_resources`.advertisement_id = 5) LIMIT 1[0m
  [1m[35mAdResource Load (0.2ms)[0m  SELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'title' AND (`ad_resources`.advertisement_id = 5) LIMIT 1
  [1m[36mAdResource Load (0.1ms)[0m  [1mSELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'subtitle' AND (`ad_resources`.advertisement_id = 5) LIMIT 1[0m
Completed 200 OK in 235ms (Views: 93.4ms | ActiveRecord: 1796.5ms)
  [1m[35mAdRequest Load (0.3ms)[0m  SELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190963 LIMIT 1
  [1m[36mAdvertisement Load (0.1ms)[0m  [1mSELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 5 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_8') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_8', '2012-03-13 09:37:59', '2012-03-13 09:37:59', 'Party_8\'s address', '123456', 0)
  [1m[36mSQL (43.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `name`, `ad_container_name`, `updated_at`) VALUES ('2012-03-13 09:37:59', 'Channe_2', 'Channe_2', '2012-03-13 09:37:59')[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 13 AND (`ad_containers`.`name` = BINARY 'AdContainer_2') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'iOTNkTsZXFvrKGwMcwUh'[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_containers` (`description`, `type`, `status`, `show_count`, `url`, `click_count`, `name`, `income`, `channel_id`, `updated_at`, `request_count`, `party_id`, `created_at`, `longitude`, `latitude`, `identity`, `os_type`) VALUES ('desc', 'Application', 1, 0, 'http://www.adhub.com/AdContainer_2', 0, 'AdContainer_2', 0.0, 417882964, '2012-03-13 09:37:59', 0, 13, '2012-03-13 09:37:59', NULL, NULL, 'iOTNkTsZXFvrKGwMcwUh', 0)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 13) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (53.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_9') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_9', '2012-03-13 09:37:59', '2012-03-13 09:37:59', 'Party_9\'s address', '123456', 0)[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`created_at`, `note`, `pay_on`, `name`, `effect_string`, `string`, `updated_at`, `unit`) VALUES ('2012-03-13 09:37:59', 'pm note', 0, 'pm_3', 'pm effect', NULL, '2012-03-13 09:37:59', 1000)
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_10') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_10', '2012-03-13 09:37:59', '2012-03-13 09:37:59', 'Party_10\'s address', '123456', 0)
  [1m[36mSQL (43.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `created_at`, `start_from`, `description`, `daily_budget`, `used_budget`, `party_id`, `end_to`, `updated_at`, `name`) VALUES (10000.0, '2012-03-13 09:38:00', '2012-03-13', 'desc', 1000.0, 0.0, 15, '2012-04-13', '2012-03-13 09:38:00', 'Campaign_3')[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `advertisements` (`impression_count`, `ad_format`, `updated_at`, `created_at`, `party_id`, `owner_maintained`, `decimal`, `click_count`, `name`, `used_budget`, `status`, `content_url`) VALUES (0, 'icon_text', '2012-03-13 09:38:00', '2012-03-13 09:38:00', 15, 1, 0, 0, 'Ad_3', 0, 2, 'http://www.ad.com/Ad_3')
  [1m[36mSQL (45.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`step`, `status`, `daily_budget`, `used_budget`, `end_to`, `advertisement_id`, `campaign_id`, `bid_price`, `updated_at`, `call_to_action_params`, `pay_method_id`, `start_from`, `call_to_action`, `channel_id`, `name`, `created_at`) VALUES (1, 1, 100.0, 0.0, '2012-04-13', 7, 5, 10.0, '2012-03-13 09:38:00', NULL, 5, '2012-03-13', 'url', 417882964, 'PublishPolicy_3', '2012-03-13 09:38:00')[0m
  [1m[35mSQL (44.8ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `publish_policies` SET `status` = 3, `updated_at` = '2012-03-13 09:38:00', `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 5
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882964 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882964 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 5 )[0m
  [1m[35mAdContainer Load (0.1ms)[0m  SELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 5 )
  [1m[36mAdShowControl Load (0.1ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 5) LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_show_controls` (`weight`, `unit_price`, `party_id`, `ad_format`, `campaign_id`, `created_at`, `size_codes`, `updated_at`, `channel_id`, `content_categories`, `advertisement_id`, `begin`, `end`, `ad_containers`, `publish_policy_id`) VALUES (1.0, 0.01, 15, 'icon_text', 5, '2012-03-13 09:38:00', NULL, '2012-03-13 09:38:00', 417882964, NULL, 7, '2012-03-13', '2012-04-13', NULL, 5)
  [1m[36mSQL (60.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:00', '2012-03-13', 0, 0.9, 0.8, 13, '2012-03-13 09:38:00', '2013-03-13')[0m
  [1m[35mSQL (45.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_11') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_11', '2012-03-13 09:38:00', '2012-03-13 09:38:00', 'Party_11\'s address', '123456', 0)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_4 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('f9e248db37b23039903fbb92fe8f62e6', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:00', 'member_4 @abc.com', 'member_4 ', '2012-03-13 09:38:00', 0, 16, NULL)[0m
  [1m[35mSQL (44.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:00', '2012-03-13 09:38:00', 'icon_text', 'square', 'icon_text_icon.jpg', 7, NULL, 10, 'image/jpeg', 'icon', 80, 80)
  [1m[36mSQL (62.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_12') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_12', '2012-03-13 09:38:00', '2012-03-13 09:38:00', 'Party_12\'s address', '123456', 0)
  [1m[36mSQL (42.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_5 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('fdb5856f381e8aba22a93660116b6054', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:00', 'member_5 @abc.com', 'member_5 ', '2012-03-13 09:38:00', 0, 17, NULL)
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:00', '2012-03-13 09:38:00', 'icon_text', NULL, NULL, 7, 'Text', 11, NULL, 'title', NULL, NULL)[0m
  [1m[35mSQL (45.9ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_13') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_13', '2012-03-13 09:38:00', '2012-03-13 09:38:00', 'Party_13\'s address', '123456', 0)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_6 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('45342a9590a69c2eaf3f3185ac37152b', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:00', 'member_6 @abc.com', 'member_6 ', '2012-03-13 09:38:00', 0, 18, NULL)[0m
  [1m[35mSQL (44.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:00', '2012-03-13 09:38:00', 'icon_text', NULL, NULL, 7, 'Text', 12, NULL, 'subtitle', NULL, NULL)
  [1m[36mSQL (45.9ms)[0m  [1mCOMMIT[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 15) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 15, '2012-03-13 09:38:00', '2012-03-13 09:38:00')
  [1m[36mSQL (45.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (35.7ms)[0m  update accounts set balance = balance + 1000 where id = 4
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 4 LIMIT 1[0m
  Processing by AdRequestsController#index as JSON
  Parameters: {"last_ad"=>7, "device"=>"mobile_phone", "size"=>"banner", "app"=>"iOTNkTsZXFvrKGwMcwUh"}
Geokit is using the domain: test.host
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'iOTNkTsZXFvrKGwMcwUh' LIMIT 1
found container #<Application:0xb541d394>
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 13 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 13) AND (expired_at >= '2012-03-13' )
  [1m[36mAdRequest Load (0.2ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258270 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_requests` (`created_at`, `agent_id`, `publisher_id`, `fulfilled`, `advertisement_id`, `updated_at`, `publisher_share_rate`, `ip_address`, `pay_method_id`, `size_code`, `ad_owner_id`, `request_date`, `unit_price`, `publish_policy_id`, `agent_share_rate`, `ad_container_id`, `campaign_id`, `shown`, `clicked`, `paid`) VALUES ('2012-03-13 09:38:00', NULL, 13, 0, NULL, '2012-03-13 09:38:00', NULL, '0.0.0.0', NULL, 'banner', NULL, '2012-03-13', NULL, NULL, NULL, 298258270, NULL, 0, 0, 0)[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258270
  [1m[36mSQL (34.5ms)[0m  [1mCOMMIT[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258270 )
  [1m[36mAdShowControl Load (0.3ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882964) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (not (advertisement_id = 7)) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258270\'%'))) ORDER BY weight * rand() desc LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mCOMMIT[0m
Completed 200 OK in 46ms (Views: 0.3ms | ActiveRecord: 1134.0ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_14') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_14', '2012-03-13 09:38:00', '2012-03-13 09:38:00', 'Party_14\'s address', '123456', 0)
  [1m[36mSQL (31.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `name`, `ad_container_name`, `updated_at`) VALUES ('2012-03-13 09:38:01', 'Channe_3', 'Channe_3', '2012-03-13 09:38:01')[0m
  [1m[35mSQL (34.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 19 AND (`ad_containers`.`name` = BINARY 'AdContainer_3') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'U9Zfzy6YoqUMHXbXKVCf'[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_containers` (`description`, `type`, `status`, `show_count`, `url`, `click_count`, `name`, `income`, `channel_id`, `updated_at`, `request_count`, `party_id`, `created_at`, `longitude`, `latitude`, `identity`, `os_type`) VALUES ('desc', 'Application', 1, 0, 'http://www.adhub.com/AdContainer_3', 0, 'AdContainer_3', 0.0, 417882965, '2012-03-13 09:38:01', 0, 19, '2012-03-13 09:38:01', NULL, NULL, 'U9Zfzy6YoqUMHXbXKVCf', 0)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 19) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (53.7ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_15') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_15', '2012-03-13 09:38:01', '2012-03-13 09:38:01', 'Party_15\'s address', '123456', 0)[0m
  [1m[35mSQL (56.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `pay_methods` (`created_at`, `note`, `pay_on`, `name`, `effect_string`, `string`, `updated_at`, `unit`) VALUES ('2012-03-13 09:38:01', 'pm note', 0, 'pm_4', 'pm effect', NULL, '2012-03-13 09:38:01', 1000)
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_16') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_16', '2012-03-13 09:38:01', '2012-03-13 09:38:01', 'Party_16\'s address', '123456', 0)
  [1m[36mSQL (43.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `created_at`, `start_from`, `description`, `daily_budget`, `used_budget`, `party_id`, `end_to`, `updated_at`, `name`) VALUES (10000.0, '2012-03-13 09:38:01', '2012-03-13', 'desc', 1000.0, 0.0, 21, '2012-04-13', '2012-03-13 09:38:01', 'Campaign_4')[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `advertisements` (`impression_count`, `ad_format`, `updated_at`, `created_at`, `party_id`, `owner_maintained`, `decimal`, `click_count`, `name`, `used_budget`, `status`, `content_url`) VALUES (0, 'icon_text', '2012-03-13 09:38:01', '2012-03-13 09:38:01', 21, 1, 0, 0, 'Ad_4', 0, 2, 'http://www.ad.com/Ad_4')
  [1m[36mSQL (45.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`step`, `status`, `daily_budget`, `used_budget`, `end_to`, `advertisement_id`, `campaign_id`, `bid_price`, `updated_at`, `call_to_action_params`, `pay_method_id`, `start_from`, `call_to_action`, `channel_id`, `name`, `created_at`) VALUES (1, 1, 100.0, 0.0, '2012-04-13', 8, 6, 10.0, '2012-03-13 09:38:01', NULL, 6, '2012-03-13', 'url', 417882965, 'PublishPolicy_4', '2012-03-13 09:38:01')[0m
  [1m[35mSQL (44.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `publish_policies` SET `status` = 3, `updated_at` = '2012-03-13 09:38:01', `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 6
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882965 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882965 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 6 )[0m
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 6 )
  [1m[36mAdShowControl Load (0.2ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 6) LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_show_controls` (`weight`, `unit_price`, `party_id`, `ad_format`, `campaign_id`, `created_at`, `size_codes`, `updated_at`, `channel_id`, `content_categories`, `advertisement_id`, `begin`, `end`, `ad_containers`, `publish_policy_id`) VALUES (1.0, 0.01, 21, 'icon_text', 6, '2012-03-13 09:38:01', NULL, '2012-03-13 09:38:01', 417882965, NULL, 8, '2012-03-13', '2012-04-13', NULL, 6)
  [1m[36mSQL (50.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:01', '2012-03-13', 0, 0.9, 0.8, 19, '2012-03-13 09:38:01', '2013-03-13')[0m
  [1m[35mSQL (44.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_17') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_17', '2012-03-13 09:38:01', '2012-03-13 09:38:01', 'Party_17\'s address', '123456', 0)[0m
  [1m[35mSQL (43.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_7 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('00176025ffd5d2a2d325cc1c47dc8427', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:01', 'member_7 @abc.com', 'member_7 ', '2012-03-13 09:38:01', 0, 22, NULL)[0m
  [1m[35mSQL (44.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:01', '2012-03-13 09:38:01', 'icon_text', 'square', 'icon_text_icon.jpg', 8, NULL, 13, 'image/jpeg', 'icon', 80, 80)
  [1m[36mSQL (62.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_18') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_18', '2012-03-13 09:38:01', '2012-03-13 09:38:01', 'Party_18\'s address', '123456', 0)
  [1m[36mSQL (43.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_8 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('99e678d8064fda5cd35f82f75f6afd6f', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:01', 'member_8 @abc.com', 'member_8 ', '2012-03-13 09:38:01', 0, 23, NULL)
  [1m[36mSQL (44.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:01', '2012-03-13 09:38:01', 'icon_text', NULL, NULL, 8, 'Text', 14, NULL, 'title', NULL, NULL)[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_19') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_19', '2012-03-13 09:38:01', '2012-03-13 09:38:01', 'Party_19\'s address', '123456', 0)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_9 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('c617f3afe83c4324198b6db499ecb918', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:01', 'member_9 @abc.com', 'member_9 ', '2012-03-13 09:38:01', 0, 24, NULL)[0m
  [1m[35mSQL (44.6ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:01', '2012-03-13 09:38:01', 'icon_text', NULL, NULL, 8, 'Text', 15, NULL, 'subtitle', NULL, NULL)
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 21) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 21, '2012-03-13 09:38:01', '2012-03-13 09:38:01')
  [1m[36mSQL (45.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (47.8ms)[0m  update accounts set balance = balance + 1000 where id = 5
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 5 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `accounts` SET `balance` = 0.0, `updated_at` = '2012-03-13 09:38:02' WHERE `accounts`.`id` = 5[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  Processing by AdRequestsController#index as JSON
  Parameters: {"device"=>"mobile_phone", "size"=>"banner", "app"=>"U9Zfzy6YoqUMHXbXKVCf"}
Geokit is using the domain: test.host
  [1m[36mAdContainer Load (0.2ms)[0m  [1mSELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'U9Zfzy6YoqUMHXbXKVCf' LIMIT 1[0m
found container #<Application:0xb51c15c8>
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 19 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 19) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAdRequest Load (0.2ms)[0m  SELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258271 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_requests` (`created_at`, `agent_id`, `publisher_id`, `fulfilled`, `advertisement_id`, `updated_at`, `publisher_share_rate`, `ip_address`, `pay_method_id`, `size_code`, `ad_owner_id`, `request_date`, `unit_price`, `publish_policy_id`, `agent_share_rate`, `ad_container_id`, `campaign_id`, `shown`, `clicked`, `paid`) VALUES ('2012-03-13 09:38:02', NULL, 19, 0, NULL, '2012-03-13 09:38:02', NULL, '0.0.0.0', NULL, 'banner', NULL, '2012-03-13', NULL, NULL, NULL, 298258271, NULL, 0, 0, 0)
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258271[0m
  [1m[35mSQL (40.1ms)[0m  COMMIT
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258271 )[0m
  [1m[35mAdShowControl Load (0.3ms)[0m  SELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882965) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258271\'%'))) ORDER BY weight * rand() desc LIMIT 1
  [1m[36mPublishPolicy Load (0.1ms)[0m  [1mSELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 6 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`publish_policy_id` = 6 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1
  [1m[36mCampaign Load (0.1ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 6 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`campaign_id` = 6 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 21 LIMIT 1[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 21) LIMIT 1
  [1m[36mAdShowControl Load (0.3ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882965) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258271\'%'))) and (not (id in (4)))) ORDER BY weight * rand() desc LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.0ms)[0m  [1mCOMMIT[0m
Completed 200 OK in 56ms (Views: 0.3ms | ActiveRecord: 1171.1ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_20') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_20', '2012-03-13 09:38:02', '2012-03-13 09:38:02', 'Party_20\'s address', '123456', 0)
  [1m[36mSQL (43.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `name`, `ad_container_name`, `updated_at`) VALUES ('2012-03-13 09:38:02', 'Channe_4', 'Channe_4', '2012-03-13 09:38:02')[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 25 AND (`ad_containers`.`name` = BINARY 'AdContainer_4') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'BjuqMtEcc9cz9AS6tvw7'[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_containers` (`description`, `type`, `status`, `show_count`, `url`, `click_count`, `name`, `income`, `channel_id`, `updated_at`, `request_count`, `party_id`, `created_at`, `longitude`, `latitude`, `identity`, `os_type`) VALUES ('desc', 'Application', 1, 0, 'http://www.adhub.com/AdContainer_4', 0, 'AdContainer_4', 0.0, 417882966, '2012-03-13 09:38:02', 0, 25, '2012-03-13 09:38:02', NULL, NULL, 'BjuqMtEcc9cz9AS6tvw7', 0)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 25) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (65.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_21') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_21', '2012-03-13 09:38:02', '2012-03-13 09:38:02', 'Party_21\'s address', '123456', 0)[0m
  [1m[35mSQL (56.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`created_at`, `note`, `pay_on`, `name`, `effect_string`, `string`, `updated_at`, `unit`) VALUES ('2012-03-13 09:38:02', 'pm note', 0, 'pm_5', 'pm effect', NULL, '2012-03-13 09:38:02', 1000)
  [1m[36mSQL (58.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_22') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_22', '2012-03-13 09:38:02', '2012-03-13 09:38:02', 'Party_22\'s address', '123456', 0)
  [1m[36mSQL (67.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `created_at`, `start_from`, `description`, `daily_budget`, `used_budget`, `party_id`, `end_to`, `updated_at`, `name`) VALUES (10000.0, '2012-03-13 09:38:02', '2012-03-13', 'desc', 1000.0, 0.0, 27, '2012-04-13', '2012-03-13 09:38:02', 'Campaign_5')[0m
  [1m[35mSQL (57.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`impression_count`, `ad_format`, `updated_at`, `created_at`, `party_id`, `owner_maintained`, `decimal`, `click_count`, `name`, `used_budget`, `status`, `content_url`) VALUES (0, 'icon_text', '2012-03-13 09:38:02', '2012-03-13 09:38:02', 27, 1, 0, 0, 'Ad_5', 0, 2, 'http://www.ad.com/Ad_5')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`step`, `status`, `daily_budget`, `used_budget`, `end_to`, `advertisement_id`, `campaign_id`, `bid_price`, `updated_at`, `call_to_action_params`, `pay_method_id`, `start_from`, `call_to_action`, `channel_id`, `name`, `created_at`) VALUES (1, 1, 100.0, 0.0, '2012-04-13', 9, 7, 10.0, '2012-03-13 09:38:02', NULL, 7, '2012-03-13', 'url', 417882966, 'PublishPolicy_5', '2012-03-13 09:38:02')[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.3ms)[0m  UPDATE `publish_policies` SET `status` = 3, `updated_at` = '2012-03-13 09:38:02', `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 7
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882966 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882966 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 7 )[0m
  [1m[35mAdContainer Load (0.1ms)[0m  SELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 7 )
  [1m[36mAdShowControl Load (0.1ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 7) LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_show_controls` (`weight`, `unit_price`, `party_id`, `ad_format`, `campaign_id`, `created_at`, `size_codes`, `updated_at`, `channel_id`, `content_categories`, `advertisement_id`, `begin`, `end`, `ad_containers`, `publish_policy_id`) VALUES (1.0, 0.01, 27, 'icon_text', 7, '2012-03-13 09:38:02', NULL, '2012-03-13 09:38:02', 417882966, NULL, 9, '2012-03-13', '2012-04-13', NULL, 7)
  [1m[36mSQL (107.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:03', '2012-03-13', 0, 0.9, 0.8, 25, '2012-03-13 09:38:03', '2013-03-13')[0m
  [1m[35mSQL (68.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_23') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_23', '2012-03-13 09:38:03', '2012-03-13 09:38:03', 'Party_23\'s address', '123456', 0)[0m
  [1m[35mSQL (55.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_10 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('9cb5001a7f847fcd3eb9b82c979a4d02', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:03', 'member_10 @abc.com', 'member_10 ', '2012-03-13 09:38:03', 0, 28, NULL)[0m
  [1m[35mSQL (56.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:03', '2012-03-13 09:38:03', 'icon_text', 'square', 'icon_text_icon.jpg', 9, NULL, 16, 'image/jpeg', 'icon', 80, 80)
  [1m[36mSQL (74.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_24') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_24', '2012-03-13 09:38:03', '2012-03-13 09:38:03', 'Party_24\'s address', '123456', 0)
  [1m[36mSQL (42.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_11 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('59b700d2b4f3c35160c934fa78e26689', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:03', 'member_11 @abc.com', 'member_11 ', '2012-03-13 09:38:03', 0, 29, NULL)
  [1m[36mSQL (32.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:03', '2012-03-13 09:38:03', 'icon_text', NULL, NULL, 9, 'Text', 17, NULL, 'title', NULL, NULL)[0m
  [1m[35mSQL (34.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_25') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_25', '2012-03-13 09:38:03', '2012-03-13 09:38:03', 'Party_25\'s address', '123456', 0)[0m
  [1m[35mSQL (30.9ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_12 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('3f6153be988c9659c414b5b10226456e', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:03', 'member_12 @abc.com', 'member_12 ', '2012-03-13 09:38:03', 0, 30, NULL)[0m
  [1m[35mSQL (32.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:03', '2012-03-13 09:38:03', 'icon_text', NULL, NULL, 9, 'Text', 18, NULL, 'subtitle', NULL, NULL)
  [1m[36mSQL (34.0ms)[0m  [1mCOMMIT[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 27) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 27, '2012-03-13 09:38:03', '2012-03-13 09:38:03')
  [1m[36mSQL (33.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (35.7ms)[0m  update accounts set balance = balance + 1000 where id = 6
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 6 LIMIT 1[0m
  Processing by AdRequestsController#index as JSON
  Parameters: {"device"=>"mobile_phone", "size"=>"banner", "app"=>"BjuqMtEcc9cz9AS6tvw7"}
Geokit is using the domain: test.host
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`identity` = 'BjuqMtEcc9cz9AS6tvw7' LIMIT 1
found container #<Application:0xb5463b14>
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 25 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 25) AND (expired_at >= '2012-03-13' )
  [1m[36mAdRequest Load (0.2ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`size_code` = 'banner' AND `ad_requests`.`ad_container_id` = 298258272 AND `ad_requests`.`ip_address` = '0.0.0.0' ORDER BY created_at desc LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_requests` (`created_at`, `agent_id`, `publisher_id`, `fulfilled`, `advertisement_id`, `updated_at`, `publisher_share_rate`, `ip_address`, `pay_method_id`, `size_code`, `ad_owner_id`, `request_date`, `unit_price`, `publish_policy_id`, `agent_share_rate`, `ad_container_id`, `campaign_id`, `shown`, `clicked`, `paid`) VALUES ('2012-03-13 09:38:03', NULL, 25, 0, NULL, '2012-03-13 09:38:03', NULL, '0.0.0.0', NULL, 'banner', NULL, '2012-03-13', NULL, NULL, NULL, 298258272, NULL, 0, 0, 0)[0m
  [1m[35mAREL (0.1ms)[0m  UPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258272
  [1m[36mSQL (38.8ms)[0m  [1mCOMMIT[0m
  [1m[35mContentCategory Load (0.2ms)[0m  SELECT * FROM `content_categories` INNER JOIN `ad_containers_content_categories` ON `content_categories`.id = `ad_containers_content_categories`.content_category_id WHERE (`ad_containers_content_categories`.ad_container_id = 298258272 )
  [1m[36mAdShowControl Load (0.3ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE ((begin <= '2012-03-13') and ((end is null) or (end >= '2012-03-13')) and (ad_format in ('icon_text','image')) and (channel_id = 417882966) and ((size_codes is null) or (size_codes like '%\'banner\'%')) and (content_categories is null) and ((ad_containers is null) or (ad_containers like '%\'298258272\'%'))) ORDER BY weight * rand() desc LIMIT 1[0m
  [1m[35mPublishPolicy Load (0.2ms)[0m  SELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 7 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`publish_policy_id` = 7 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1[0m
  [1m[35mCampaign Load (0.1ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 7 LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT SUM(`ad_requests`.`unit_price`) AS sum_id FROM `ad_requests` WHERE `ad_requests`.`campaign_id` = 7 AND `ad_requests`.`request_date` = '2012-03-13' AND `ad_requests`.`paid` = 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 27 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 27) LIMIT 1[0m
  [1m[35mPayMethod Load (0.1ms)[0m  SELECT `pay_methods`.* FROM `pay_methods` WHERE `pay_methods`.`id` = 7 LIMIT 1
  [1m[36mAdvertisement Load (0.2ms)[0m  [1mSELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 9 LIMIT 1[0m
  [1m[35mCampaign Load (0.0ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 7 LIMIT 1
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 27 LIMIT 1[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 25) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `ad_requests` SET `fulfilled` = 1, `advertisement_id` = 9, `updated_at` = '2012-03-13 09:38:03', `publisher_share_rate` = 0.8, `pay_method_id` = 7, `ad_owner_id` = 27, `unit_price` = 0.01, `publish_policy_id` = 7, `agent_share_rate` = 0.0, `campaign_id` = 7 WHERE `ad_requests`.`id` = 980190966
  [1m[36mSQL (47.2ms)[0m  [1mCOMMIT[0m
  [1m[35mAdvertisement Load (0.1ms)[0m  SELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 9 LIMIT 1
advertisement = #<Advertisement:0xb5425d3c>
  [1m[36mAdResource Load (0.2ms)[0m  [1mSELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'icon' AND (`ad_resources`.advertisement_id = 9) LIMIT 1[0m
  [1m[35mAdResource Load (0.2ms)[0m  SELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'title' AND (`ad_resources`.advertisement_id = 9) LIMIT 1
  [1m[36mAdResource Load (0.2ms)[0m  [1mSELECT `ad_resources`.* FROM `ad_resources` WHERE `ad_resources`.`name` = 'subtitle' AND (`ad_resources`.advertisement_id = 9) LIMIT 1[0m
Completed 200 OK in 111ms (Views: 0.6ms | ActiveRecord: 1318.6ms)
  [1m[35mAdRequest Load (0.2ms)[0m  SELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190966 LIMIT 1
  [1m[36mAdContainer Load (0.1ms)[0m  [1mSELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`id` = 298258272 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_26') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_26', '2012-03-13 09:38:03', '2012-03-13 09:38:03', 'Party_26\'s address', '123456', 0)
  [1m[36mSQL (43.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `channels` (`created_at`, `name`, `ad_container_name`, `updated_at`) VALUES ('2012-03-13 09:38:03', 'Channe_5', 'Channe_5', '2012-03-13 09:38:03')[0m
  [1m[35mSQL (46.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `ad_containers` WHERE `ad_containers`.`party_id` = 31 AND (`ad_containers`.`name` = BINARY 'AdContainer_5') LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `ad_containers` WHERE `ad_containers`.`identity` = 'hmafGgMH0FCnA783NBKp'[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_containers` (`description`, `type`, `status`, `show_count`, `url`, `click_count`, `name`, `income`, `channel_id`, `updated_at`, `request_count`, `party_id`, `created_at`, `longitude`, `latitude`, `identity`, `os_type`) VALUES ('desc', 'Application', 1, 0, 'http://www.adhub.com/AdContainer_5', 0, 'AdContainer_5', 0.0, 417882967, '2012-03-13 09:38:03', 0, 31, '2012-03-13 09:38:03', NULL, NULL, 'hmafGgMH0FCnA783NBKp', 0)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 31) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (53.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_27') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_27', '2012-03-13 09:38:04', '2012-03-13 09:38:04', 'Party_27\'s address', '123456', 0)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `pay_methods` (`created_at`, `note`, `pay_on`, `name`, `effect_string`, `string`, `updated_at`, `unit`) VALUES ('2012-03-13 09:38:04', 'pm note', 0, 'pm_6', 'pm effect', NULL, '2012-03-13 09:38:04', 1000)
  [1m[36mSQL (58.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_28') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_28', '2012-03-13 09:38:04', '2012-03-13 09:38:04', 'Party_28\'s address', '123456', 0)
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `campaigns` (`budget`, `created_at`, `start_from`, `description`, `daily_budget`, `used_budget`, `party_id`, `end_to`, `updated_at`, `name`) VALUES (10000.0, '2012-03-13 09:38:04', '2012-03-13', 'desc', 1000.0, 0.0, 33, '2012-04-13', '2012-03-13 09:38:04', 'Campaign_6')[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `advertisements` (`impression_count`, `ad_format`, `updated_at`, `created_at`, `party_id`, `owner_maintained`, `decimal`, `click_count`, `name`, `used_budget`, `status`, `content_url`) VALUES (0, 'icon_text', '2012-03-13 09:38:04', '2012-03-13 09:38:04', 33, 1, 0, 0, 'Ad_6', 0, 2, 'http://www.ad.com/Ad_6')
  [1m[36mSQL (45.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `publish_policies` (`step`, `status`, `daily_budget`, `used_budget`, `end_to`, `advertisement_id`, `campaign_id`, `bid_price`, `updated_at`, `call_to_action_params`, `pay_method_id`, `start_from`, `call_to_action`, `channel_id`, `name`, `created_at`) VALUES (1, 1, 100.0, 0.0, '2012-04-13', 10, 8, 10.0, '2012-03-13 09:38:04', NULL, 8, '2012-03-13', 'url', 417882967, 'PublishPolicy_6', '2012-03-13 09:38:04')[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `publish_policies` SET `status` = 3, `updated_at` = '2012-03-13 09:38:04', `call_to_action_params` = NULL WHERE `publish_policies`.`id` = 8
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (channel_id = 417882967 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(DISTINCT `publish_policies`.`id`) FROM `publish_policies` LEFT OUTER JOIN `advertisements` ON `advertisements`.`id` = `publish_policies`.`advertisement_id` WHERE (bid_price < 10.0 and channel_id = 417882967 and start_from <= '2012-03-13' and (end_to is null or end_to >= '2012-03-13') and publish_policies.status <> 0 and advertisements.status = 2)
  [1m[36mContentCategory Load (0.2ms)[0m  [1mSELECT * FROM `content_categories` INNER JOIN `content_categories_publish_policies` ON `content_categories`.id = `content_categories_publish_policies`.content_category_id WHERE (`content_categories_publish_policies`.publish_policy_id = 8 )[0m
  [1m[35mAdContainer Load (0.2ms)[0m  SELECT * FROM `ad_containers` INNER JOIN `ad_containers_publish_policies` ON `ad_containers`.id = `ad_containers_publish_policies`.ad_container_id WHERE (`ad_containers_publish_policies`.publish_policy_id = 8 )
  [1m[36mAdShowControl Load (0.2ms)[0m  [1mSELECT `ad_show_controls`.* FROM `ad_show_controls` WHERE (`ad_show_controls`.publish_policy_id = 8) LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_show_controls` (`weight`, `unit_price`, `party_id`, `ad_format`, `campaign_id`, `created_at`, `size_codes`, `updated_at`, `channel_id`, `content_categories`, `advertisement_id`, `begin`, `end`, `ad_containers`, `publish_policy_id`) VALUES (1.0, 0.01, 33, 'icon_text', 8, '2012-03-13 09:38:04', NULL, '2012-03-13 09:38:04', 417882967, NULL, 10, '2012-03-13', '2012-04-13', NULL, 8)
  [1m[36mSQL (48.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:04', '2012-03-13', 0, 0.9, 0.8, 31, '2012-03-13 09:38:04', '2013-03-13')[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_29') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_29', '2012-03-13 09:38:04', '2012-03-13 09:38:04', 'Party_29\'s address', '123456', 0)[0m
  [1m[35mSQL (43.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_13 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('7380f249abaa937f0947f7875ba772ae', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:04', 'member_13 @abc.com', 'member_13 ', '2012-03-13 09:38:04', 0, 34, NULL)[0m
  [1m[35mSQL (44.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:04', '2012-03-13 09:38:04', 'icon_text', 'square', 'icon_text_icon.jpg', 10, NULL, 19, 'image/jpeg', 'icon', 80, 80)
  [1m[36mSQL (62.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_30') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_30', '2012-03-13 09:38:04', '2012-03-13 09:38:04', 'Party_30\'s address', '123456', 0)
  [1m[36mSQL (43.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_14 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('7f25b54da746ec068d8afe5224e7a7e5', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:04', 'member_14 @abc.com', 'member_14 ', '2012-03-13 09:38:04', 0, 35, NULL)
  [1m[36mSQL (44.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:04', '2012-03-13 09:38:04', 'icon_text', NULL, NULL, 10, 'Text', 20, NULL, 'title', NULL, NULL)[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_31') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_31', '2012-03-13 09:38:04', '2012-03-13 09:38:04', 'Party_31\'s address', '123456', 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_15 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('1bd941e0cae5438939edb68b0a24b6f2', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:04', 'member_15 @abc.com', 'member_15 ', '2012-03-13 09:38:04', 0, 36, NULL)[0m
  [1m[35mSQL (44.7ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `ad_resources` (`updated_at`, `created_at`, `ad_format`, `size_code`, `file`, `advertisement_id`, `text`, `member_id`, `file_content_type`, `name`, `height`, `width`) VALUES ('2012-03-13 09:38:04', '2012-03-13 09:38:04', 'icon_text', NULL, NULL, 10, 'Text', 21, NULL, 'subtitle', NULL, NULL)
  [1m[36mSQL (46.1ms)[0m  [1mCOMMIT[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 33, '2012-03-13 09:38:04', '2012-03-13 09:38:04')
  [1m[36mSQL (45.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (47.8ms)[0m  update accounts set balance = balance + 1000 where id = 7
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 7 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `ad_requests` (`created_at`, `agent_id`, `publisher_id`, `fulfilled`, `advertisement_id`, `updated_at`, `publisher_share_rate`, `ip_address`, `pay_method_id`, `size_code`, `ad_owner_id`, `request_date`, `unit_price`, `publish_policy_id`, `agent_share_rate`, `ad_container_id`, `campaign_id`, `shown`, `clicked`, `paid`) VALUES ('2012-03-13 09:38:04', NULL, 31, 0, NULL, '2012-03-13 09:38:04', NULL, '127.0.0.1', NULL, 'banner', NULL, '2012-03-13', NULL, NULL, NULL, 298258273, NULL, 0, 0, 0)[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `ad_containers` SET `request_count` = COALESCE(`request_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258273
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 31) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.3ms)[0m  UPDATE `ad_requests` SET `fulfilled` = 1, `advertisement_id` = 10, `updated_at` = '2012-03-13 09:38:05', `publisher_share_rate` = 0.8, `pay_method_id` = 8, `ad_owner_id` = 33, `unit_price` = 0.01, `publish_policy_id` = 8, `agent_share_rate` = 0.0, `campaign_id` = 8 WHERE `ad_requests`.`id` = 980190967
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (47.7ms)[0m  update accounts set balance = balance + 100 where id = 7
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 7 LIMIT 1[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 31) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 31, '2012-03-13 09:38:05', '2012-03-13 09:38:05')
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  Processing by AdRequestsController#shown as HTML
  Parameters: {"id"=>980190967}
Geokit is using the domain: test.host
  [1m[35mAdRequest Load (0.3ms)[0m  SELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190967 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAdvertisement Load (0.1ms)[0m  SELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 10 LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `advertisements` SET `impression_count` = COALESCE(`impression_count`, 0) + 1 WHERE `advertisements`.`id` = 10[0m
  [1m[35mPayMethod Load (0.1ms)[0m  SELECT `pay_methods`.* FROM `pay_methods` WHERE `pay_methods`.`id` = 8 LIMIT 1
  [1m[36mPublishPolicy Load (0.1ms)[0m  [1mSELECT `publish_policies`.* FROM `publish_policies` WHERE `publish_policies`.`id` = 8 LIMIT 1[0m
  [1m[35mAdvertisement Load (0.1ms)[0m  SELECT `advertisements`.* FROM `advertisements` WHERE `advertisements`.`id` = 10 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 33 LIMIT 1[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mupdate accounts set balance = balance - 0.01 where id = 7[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 7 LIMIT 1
  [1m[36mCampaign Load (0.1ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 8 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  update campaigns set used_budget = used_budget + 0.01 where id = 8
  [1m[36mCampaign Load (0.1ms)[0m  [1mSELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 8 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  update publish_policies set used_budget = used_budget + 0.01 where id = 8
  [1m[36mAdContainer Load (0.1ms)[0m  [1mSELECT `ad_containers`.* FROM `ad_containers` WHERE `ad_containers`.`id` = 298258273 LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  update ad_containers set income = income + 0.008 where id = 298258273
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 31 LIMIT 1[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 31) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mupdate accounts set balance = balance + 0.008 where id = 8[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 8 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`adhub_operator` = 1 LIMIT 1[0m
  [1m[35mAccount Load (0.1ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 1) LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 1, '2012-03-13 09:38:05', '2012-03-13 09:38:05')[0m
  [1m[35mSQL (0.1ms)[0m  update accounts set balance = balance + 0.002 where id = 9
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE `accounts`.`id` = 9 LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  UPDATE `ad_requests` SET `updated_at` = '2012-03-13 09:38:05', `paid` = 1 WHERE `ad_requests`.`id` = 980190967
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 33 LIMIT 1[0m
  [1m[35mParty Load (0.0ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 33 LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  UPDATE `ad_requests` SET `updated_at` = '2012-03-13 09:38:05', `shown` = 1 WHERE `ad_requests`.`id` = 980190967
  [1m[36mAREL (0.1ms)[0m  [1mUPDATE `ad_containers` SET `show_count` = COALESCE(`show_count`, 0) + 1 WHERE `ad_containers`.`id` = 298258273[0m
  [1m[35mSQL (52.9ms)[0m  COMMIT
Completed 200 OK in 75ms (Views: 3.9ms | ActiveRecord: 1341.7ms)
  [1m[36mAdRequest Load (0.3ms)[0m  [1mSELECT `ad_requests`.* FROM `ad_requests` WHERE `ad_requests`.`id` = 980190967 LIMIT 1[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 33) LIMIT 1
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 31) LIMIT 1[0m
  [1m[35mCampaign Load (0.1ms)[0m  SELECT `campaigns`.* FROM `campaigns` WHERE `campaigns`.`id` = 8 LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.4ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_32') LIMIT 1
  [1m[36mAREL (0.3ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_32', '2012-03-13 09:38:05', '2012-03-13 09:38:05', 'Party_32\'s address', '123456', 0)[0m
  [1m[35mSQL (43.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_16 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('3fc9ad5958e94a01ed0a3807676c5c0e', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:05', 'member_16 @abc.com', 'member_16 ', '2012-03-13 09:38:05', 1, 37, NULL)[0m
  [1m[35mSQL (44.8ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_33') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_33', '2012-03-13 09:38:05', '2012-03-13 09:38:05', 'Party_33\'s address', '123456', 0)[0m
  [1m[35mSQL (56.6ms)[0m  COMMIT
  Processing by Admin::ContractsController#new as HTML
  Parameters: {"party_id"=>38, "business_type"=>0}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 22 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 38 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 37 LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 37) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 37) LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 37, '2012-03-13 09:38:05', '2012-03-13 09:38:05')
  [1m[36mSQL (61.2ms)[0m  [1mCOMMIT[0m
Rendered _page_head.html.erb (72.7ms)
Rendered side_bar/_admin_console.html.erb (2.6ms)
Rendered _page_foot.html.erb (0.2ms)
Completed 200 OK in 96ms (Views: 31.3ms | ActiveRecord: 369.5ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_34') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_34', '2012-03-13 09:38:05', '2012-03-13 09:38:05', 'Party_34\'s address', '123456', 0)
  [1m[36mSQL (31.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_17 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('04162fd76926174c6589492dbb28f04b', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:05', 'member_17 @abc.com', 'member_17 ', '2012-03-13 09:38:05', 1, 39, NULL)
  [1m[36mSQL (32.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_35') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_35', '2012-03-13 09:38:06', '2012-03-13 09:38:06', 'Party_35\'s address', '123456', 0)
  [1m[36mSQL (32.0ms)[0m  [1mCOMMIT[0m
  Processing by Admin::ContractsController#create as HTML
  Parameters: {"party_id"=>40, "contract"=>{"contact_person"=>"person", "start_from"=>Tue, 13 Mar 2012, "expired_at"=>Wed, 13 Mar 2013, "business_type"=>2, "mobile_phone"=>"123456"}}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 23 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 40 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:06', '2012-03-13', 2, NULL, NULL, 40, '2012-03-13 09:38:06', '2013-03-13')[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 40 LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mUPDATE `parties` SET `agent_id` = 39, `updated_at` = '2012-03-13 09:38:06' WHERE `parties`.`id` = 40[0m
Redirected to http://test.host/admin/parties/40.html
  [1m[35mSQL (47.6ms)[0m  COMMIT
Completed 302 Found in 54ms
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 40 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 39 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_36') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_36', '2012-03-13 09:38:06', '2012-03-13 09:38:06', 'Party_36\'s address', '123456', 0)[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:06', '2012-03-13', 1, NULL, NULL, 41, '2012-03-13 09:38:06', '2013-03-13')
  [1m[36mSQL (44.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_18 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('374c8d45279fe944595a128b4706b2dd', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:06', 'member_18 @abc.com', 'member_18 ', '2012-03-13 09:38:06', 0, 41, NULL)
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 24)
  [1m[36mSQL (42.6ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 24)
  [1m[36mSQL (46.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 41, NULL, 0, 'ad_party1', '2012-03-13 09:38:06', '2012-03-13 09:38:06', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (44.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:06', '2012-03-13', 2, NULL, NULL, 42, '2012-03-13 09:38:06', '2013-03-13')[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 41, NULL, 0, 'ad_party2', '2012-03-13 09:38:06', '2012-03-13 09:38:06', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:06', '2012-03-13', 2, NULL, NULL, 43, '2012-03-13 09:38:06', '2013-03-13')
  [1m[36mSQL (45.3ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  Processing by PartiesController#new as HTML
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
check_result is true
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
Rendered parties/_f.html.erb (2.4ms)
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (0.1ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 4) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 4, '2012-03-13 09:38:07', '2012-03-13 09:38:07')[0m
  [1m[35mSQL (62.5ms)[0m  COMMIT
Rendered _page_head.html.erb (74.3ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 91ms (Views: 22.7ms | ActiveRecord: 867.1ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_37') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_37', '2012-03-13 09:38:07', '2012-03-13 09:38:07', 'Party_37\'s address', '123456', 0)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (46.5ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:07', '2012-03-13', 1, NULL, NULL, 44, '2012-03-13 09:38:07', '2013-03-13')
  [1m[36mSQL (70.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_19 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('5d1213916ba93e615ac6877d1c6d80ec', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:07', 'member_19 @abc.com', 'member_19 ', '2012-03-13 09:38:07', 0, 44, NULL)
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (94.8ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 25)
  [1m[36mSQL (59.9ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (25, 4)
  [1m[36mSQL (94.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 44, NULL, 0, 'ad_party1', '2012-03-13 09:38:07', '2012-03-13 09:38:07', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (44.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:07', '2012-03-13', 2, NULL, NULL, 45, '2012-03-13 09:38:07', '2013-03-13')[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 44, NULL, 0, 'ad_party2', '2012-03-13 09:38:07', '2012-03-13 09:38:07', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:07', '2012-03-13', 2, NULL, NULL, 46, '2012-03-13 09:38:07', '2013-03-13')
  [1m[36mSQL (33.3ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 5 LIMIT 1[0m
  Processing by PartiesController#edit as HTML
  Parameters: {"id"=>#<Party id: 5, agent_id: 4, party_type: nil, adhub_operator: false, name: "Ad Owner with Agent", address: nil, phone_number: nil, post_code: nil, created_at: "2012-03-13 09:38:07", updated_at: "2012-03-13 09:38:07", sales_id: 6, ad_maintained_by: 0, archived: false>}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 5 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )[0m
  [1m[35mSQL (17.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
check_result is true
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
Rendered parties/_f.html.erb (2.0ms)
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 5) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 4) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 4, '2012-03-13 09:38:07', '2012-03-13 09:38:07')
  [1m[36mSQL (54.6ms)[0m  [1mCOMMIT[0m
Rendered _page_head.html.erb (69.0ms)
Rendered side_bar/_agent.html.erb (1.0ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 174ms (Views: 28.2ms | ActiveRecord: 772.2ms)
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_38') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_38', '2012-03-13 09:38:08', '2012-03-13 09:38:08', 'Party_38\'s address', '123456', 0)
  [1m[36mSQL (32.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:08', '2012-03-13', 1, NULL, NULL, 47, '2012-03-13 09:38:08', '2013-03-13')[0m
  [1m[35mSQL (33.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_20 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('8e67723e777fe29a11ac4eca2b688a92', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:08', 'member_20 @abc.com', 'member_20 ', '2012-03-13 09:38:08', 0, 47, NULL)[0m
  [1m[35mSQL (32.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 26)[0m
  [1m[35mSQL (46.2ms)[0m  COMMIT
  [1m[36mRole Load (0.3ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 26)[0m
  [1m[35mSQL (46.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 47, NULL, 0, 'ad_party1', '2012-03-13 09:38:08', '2012-03-13 09:38:08', 'ad_party1\'s address', '123456', 0)[0m
  [1m[35mSQL (44.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:08', '2012-03-13', 2, NULL, NULL, 48, '2012-03-13 09:38:08', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 47, NULL, 0, 'ad_party2', '2012-03-13 09:38:08', '2012-03-13 09:38:08', 'ad_party2\'s address', '123456', 0)
  [1m[36mSQL (43.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:08', '2012-03-13', 2, NULL, NULL, 49, '2012-03-13 09:38:08', '2013-03-13')[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1[0m
  Processing by PartiesController#index as HTML
Geokit is using the domain: test.host
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.3ms)[0m  SELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 4)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0
  [1m[36mParty Load (0.3ms)[0m  [1mSELECT `parties`.`id` AS t0_r0, `parties`.`agent_id` AS t0_r1, `parties`.`party_type` AS t0_r2, `parties`.`adhub_operator` AS t0_r3, `parties`.`name` AS t0_r4, `parties`.`address` AS t0_r5, `parties`.`phone_number` AS t0_r6, `parties`.`post_code` AS t0_r7, `parties`.`created_at` AS t0_r8, `parties`.`updated_at` AS t0_r9, `parties`.`sales_id` AS t0_r10, `parties`.`ad_maintained_by` AS t0_r11, `parties`.`archived` AS t0_r12, `contracts`.`id` AS t1_r0, `contracts`.`business_type` AS t1_r1, `contracts`.`party_id` AS t1_r2, `contracts`.`expiration_processed` AS t1_r3, `contracts`.`start_from` AS t1_r4, `contracts`.`expired_at` AS t1_r5, `contracts`.`contact_person` AS t1_r6, `contracts`.`mobile_phone` AS t1_r7, `contracts`.`created_at` AS t1_r8, `contracts`.`updated_at` AS t1_r9, `contracts`.`share_rate_1` AS t1_r10, `contracts`.`share_rate_2` AS t1_r11 FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE `parties`.`id` IN (5) AND ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 4)) ORDER BY parties.created_at desc[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 5) LIMIT 1
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 6 LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 5)
Rendered parties/_party.html.erb (5.8ms)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mRole Load (0.3ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 4) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 4, '2012-03-13 09:38:08', '2012-03-13 09:38:08')[0m
  [1m[35mSQL (56.7ms)[0m  COMMIT
Rendered _page_head.html.erb (70.6ms)
Rendered side_bar/_agent.html.erb (0.6ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 92ms (Views: 26.1ms | ActiveRecord: 485.6ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_39') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_39', '2012-03-13 09:38:08', '2012-03-13 09:38:08', 'Party_39\'s address', '123456', 0)[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:08', '2012-03-13', 1, NULL, NULL, 50, '2012-03-13 09:38:08', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_21 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('e8e170542da1155fd109f50a4a46c2e2', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:08', 'member_21 @abc.com', 'member_21 ', '2012-03-13 09:38:08', 0, 50, NULL)
  [1m[36mSQL (68.2ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (27, 1)
  [1m[36mSQL (70.4ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 27)
  [1m[36mSQL (70.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 50, NULL, 0, 'ad_party1', '2012-03-13 09:38:09', '2012-03-13 09:38:09', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (55.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:09', '2012-03-13', 2, NULL, NULL, 51, '2012-03-13 09:38:09', '2013-03-13')[0m
  [1m[35mSQL (45.3ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 50, NULL, 0, 'ad_party2', '2012-03-13 09:38:09', '2012-03-13 09:38:09', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (44.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:09', '2012-03-13', 2, NULL, NULL, 52, '2012-03-13 09:38:09', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1[0m
  Processing by PartiesController#edit as HTML
  Parameters: {"id"=>#<Party id: 3, agent_id: nil, party_type: nil, adhub_operator: false, name: "Ad Owner", address: nil, phone_number: nil, post_code: nil, created_at: "2012-03-13 09:38:08", updated_at: "2012-03-13 09:38:08", sales_id: nil, ad_maintained_by: 0, archived: false>}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 4 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 4 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 4) AND (expired_at >= '2012-03-13' )
check_result is false
Redirected to http://test.host/
Completed 302 Found in 5ms
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_40') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_40', '2012-03-13 09:38:09', '2012-03-13 09:38:09', 'Party_40\'s address', '123456', 0)[0m
  [1m[35mSQL (44.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:09', '2012-03-13', 1, NULL, NULL, 53, '2012-03-13 09:38:09', '2013-03-13')
  [1m[36mSQL (57.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_22 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('bdd4ecf88808ba4d32b6c7711fd2e1eb', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:09', 'member_22 @abc.com', 'member_22 ', '2012-03-13 09:38:09', 0, 53, NULL)
  [1m[36mSQL (39.6ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 28)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 28)
  [1m[36mSQL (46.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 53, NULL, 0, 'ad_party1', '2012-03-13 09:38:09', '2012-03-13 09:38:09', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (43.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:09', '2012-03-13', 2, NULL, NULL, 54, '2012-03-13 09:38:09', '2013-03-13')[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 53, NULL, 0, 'ad_party2', '2012-03-13 09:38:09', '2012-03-13 09:38:09', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:09', '2012-03-13', 2, NULL, NULL, 55, '2012-03-13 09:38:09', '2013-03-13')
  [1m[36mSQL (44.8ms)[0m  [1mCOMMIT[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE (`contracts`.party_id = 54)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `contracts` SET `expiration_processed` = 1, `updated_at` = '2012-03-13 09:38:09' WHERE `contracts`.`id` = 24
  [1m[36mSQL (45.4ms)[0m  [1mCOMMIT[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 54 LIMIT 1
  Processing by PartiesController#archived as JS
  Parameters: {"id"=>54}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 28 LIMIT 1[0m
  [1m[35mParty Load (0.0ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 54 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 53 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 28 )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 53) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 53 LIMIT 1
check_result is true
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 54)[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') AND (`parties`.id <> 54) LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `parties` SET `archived` = 1, `updated_at` = '2012-03-13 09:38:09' WHERE `parties`.`id` = 54
  [1m[36mSQL (47.3ms)[0m  [1mCOMMIT[0m
now archived party.id is 54
Completed 200 OK in 66ms (Views: 7.6ms | ActiveRecord: 1147.1ms)
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 54 LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_41') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_41', '2012-03-13 09:38:10', '2012-03-13 09:38:10', 'Party_41\'s address', '123456', 0)[0m
  [1m[35mSQL (43.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:10', '2012-03-13', 1, NULL, NULL, 56, '2012-03-13 09:38:10', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_23 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('cf991458faab4fdae894cc5518446297', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:10', 'member_23 @abc.com', 'member_23 ', '2012-03-13 09:38:10', 0, 56, NULL)
  [1m[36mSQL (32.0ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (29, 1)
  [1m[36mSQL (34.2ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (29, 4)
  [1m[36mSQL (34.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 56, NULL, 0, 'ad_party1', '2012-03-13 09:38:10', '2012-03-13 09:38:10', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:10', '2012-03-13', 2, NULL, NULL, 57, '2012-03-13 09:38:10', '2013-03-13')[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 56, NULL, 0, 'ad_party2', '2012-03-13 09:38:10', '2012-03-13 09:38:10', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:10', '2012-03-13', 2, NULL, NULL, 58, '2012-03-13 09:38:10', '2013-03-13')
  [1m[36mSQL (56.9ms)[0m  [1mCOMMIT[0m
  Processing by PartiesController#archived as JS
  Parameters: {"id"=>57}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.3ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 29 LIMIT 1
  [1m[36mParty Load (0.7ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 57 LIMIT 1[0m
  [1m[35mParty Load (2.5ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 56 LIMIT 1
  [1m[36mRole Load (0.3ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 29 )[0m
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 56) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.7ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 56 LIMIT 1[0m
check_result is true
  [1m[35mSQL (0.8ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 57)
Completed 200 OK in 15ms (Views: 0.5ms | ActiveRecord: 437.6ms)
  [1m[36mParty Load (0.6ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 57 LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_42') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_42', '2012-03-13 09:38:10', '2012-03-13 09:38:10', 'Party_42\'s address', '123456', 0)
  [1m[36mSQL (43.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:10', '2012-03-13', 1, NULL, NULL, 59, '2012-03-13 09:38:10', '2013-03-13')[0m
  [1m[35mSQL (45.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_24 @abc.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('88bacd683c1c3f0a53fe6b1036381ab8', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:10', 'member_24 @abc.com', 'member_24 ', '2012-03-13 09:38:10', 0, 59, NULL)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 30)[0m
  [1m[35mSQL (46.4ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (30, 4)[0m
  [1m[35mSQL (46.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 59, NULL, 0, 'ad_party1', '2012-03-13 09:38:10', '2012-03-13 09:38:10', 'ad_party1\'s address', '123456', 0)[0m
  [1m[35mSQL (44.0ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:10', '2012-03-13', 2, NULL, NULL, 60, '2012-03-13 09:38:10', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 59, NULL, 0, 'ad_party2', '2012-03-13 09:38:11', '2012-03-13 09:38:11', 'ad_party2\'s address', '123456', 0)
  [1m[36mSQL (45.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:11', '2012-03-13', 2, NULL, NULL, 61, '2012-03-13 09:38:11', '2013-03-13')[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  Processing by PartiesController#index as HTML
  Parameters: {"archived"=>"1"}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 30 LIMIT 1[0m
  [1m[35mParty Load (0.1ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 59 LIMIT 1
  [1m[36mParty Load (0.3ms)[0m  [1mSELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.agent_id = 59)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0[0m
  [1m[35mParty Load (0.4ms)[0m  SELECT `parties`.`id` AS t0_r0, `parties`.`agent_id` AS t0_r1, `parties`.`party_type` AS t0_r2, `parties`.`adhub_operator` AS t0_r3, `parties`.`name` AS t0_r4, `parties`.`address` AS t0_r5, `parties`.`phone_number` AS t0_r6, `parties`.`post_code` AS t0_r7, `parties`.`created_at` AS t0_r8, `parties`.`updated_at` AS t0_r9, `parties`.`sales_id` AS t0_r10, `parties`.`ad_maintained_by` AS t0_r11, `parties`.`archived` AS t0_r12, `contracts`.`id` AS t1_r0, `contracts`.`business_type` AS t1_r1, `contracts`.`party_id` AS t1_r2, `contracts`.`expiration_processed` AS t1_r3, `contracts`.`start_from` AS t1_r4, `contracts`.`expired_at` AS t1_r5, `contracts`.`contact_person` AS t1_r6, `contracts`.`mobile_phone` AS t1_r7, `contracts`.`created_at` AS t1_r8, `contracts`.`updated_at` AS t1_r9, `contracts`.`share_rate_1` AS t1_r10, `contracts`.`share_rate_2` AS t1_r11 FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE `parties`.`id` IN (61, 60) AND ((contracts.business_type = 2) and (parties.agent_id = 59)) ORDER BY parties.created_at desc
  [1m[36mContract Load (0.2ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 61) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 61)
  [1m[36mContract Load (0.2ms)[0m  [1mSELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 60) LIMIT 1[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 60)
Rendered parties/_party.html.erb (7.6ms)
  [1m[36mSQL (0.3ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 30 )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mParty Load (0.2ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.0ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 59) AND (expired_at >= '2012-03-13' )
  [1m[36mAccount Load (0.2ms)[0m  [1mSELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 59) LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 59, '2012-03-13 09:38:11', '2012-03-13 09:38:11')[0m
  [1m[35mSQL (73.3ms)[0m  COMMIT
Rendered _page_head.html.erb (87.2ms)
Rendered side_bar/_agent.html.erb (0.6ms)
Rendered _page_foot.html.erb (0.0ms)
Completed 200 OK in 109ms (Views: 25.3ms | ActiveRecord: 539.7ms)
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_43') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_43', '2012-03-13 09:38:11', '2012-03-13 09:38:11', 'Party_43\'s address', '123456', 0)[0m
  [1m[35mSQL (49.1ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:11', '2012-03-13', 1, NULL, NULL, 62, '2012-03-13 09:38:11', '2013-03-13')
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_25 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('50369fc0cca5cde12ab84de92eecc695', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:11', 'member_25 @abc.com', 'member_25 ', '2012-03-13 09:38:11', 0, 62, NULL)
  [1m[36mSQL (43.6ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (31, 1)
  [1m[36mSQL (46.2ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 31)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 62, NULL, 0, 'ad_party1', '2012-03-13 09:38:11', '2012-03-13 09:38:11', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (43.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:11', '2012-03-13', 2, NULL, NULL, 63, '2012-03-13 09:38:11', '2013-03-13')[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 62, NULL, 0, 'ad_party2', '2012-03-13 09:38:11', '2012-03-13 09:38:11', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:11', '2012-03-13', 2, NULL, NULL, 64, '2012-03-13 09:38:11', '2013-03-13')
  [1m[36mSQL (44.8ms)[0m  [1mCOMMIT[0m
  Processing by PartiesController#index as HTML
Geokit is using the domain: test.host
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 31 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 62 LIMIT 1[0m
  [1m[35mParty Load (0.3ms)[0m  SELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 62)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0
  [1m[36mParty Load (0.3ms)[0m  [1mSELECT `parties`.`id` AS t0_r0, `parties`.`agent_id` AS t0_r1, `parties`.`party_type` AS t0_r2, `parties`.`adhub_operator` AS t0_r3, `parties`.`name` AS t0_r4, `parties`.`address` AS t0_r5, `parties`.`phone_number` AS t0_r6, `parties`.`post_code` AS t0_r7, `parties`.`created_at` AS t0_r8, `parties`.`updated_at` AS t0_r9, `parties`.`sales_id` AS t0_r10, `parties`.`ad_maintained_by` AS t0_r11, `parties`.`archived` AS t0_r12, `contracts`.`id` AS t1_r0, `contracts`.`business_type` AS t1_r1, `contracts`.`party_id` AS t1_r2, `contracts`.`expiration_processed` AS t1_r3, `contracts`.`start_from` AS t1_r4, `contracts`.`expired_at` AS t1_r5, `contracts`.`contact_person` AS t1_r6, `contracts`.`mobile_phone` AS t1_r7, `contracts`.`created_at` AS t1_r8, `contracts`.`updated_at` AS t1_r9, `contracts`.`share_rate_1` AS t1_r10, `contracts`.`share_rate_2` AS t1_r11 FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE `parties`.`id` IN (63) AND ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 62)) ORDER BY parties.created_at desc[0m
  [1m[35mContract Load (0.2ms)[0m  SELECT `contracts`.* FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 63) LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`expiration_processed` = 0 AND (`contracts`.party_id = 63)[0m
Rendered parties/_party.html.erb (4.4ms)
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.2ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mRole Load (0.3ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 31 )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`ad_maintained_by` = 2
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 62) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 62) LIMIT 1
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `accounts` (`balance`, `party_id`, `created_at`, `updated_at`) VALUES (0.0, 62, '2012-03-13 09:38:11', '2012-03-13 09:38:11')
  [1m[36mSQL (74.4ms)[0m  [1mCOMMIT[0m
Rendered _page_head.html.erb (90.6ms)
Rendered side_bar/_agent.html.erb (0.7ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 109ms (Views: 25.4ms | ActiveRecord: 554.6ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_44') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_44', '2012-03-13 09:38:12', '2012-03-13 09:38:12', 'Party_44\'s address', '123456', 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:12', '2012-03-13', 1, NULL, NULL, 65, '2012-03-13 09:38:12', '2013-03-13')[0m
  [1m[35mSQL (45.0ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_26 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('b6b5a0d49e19f804054b5b3ebdd73e1b', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:12', 'member_26 @abc.com', 'member_26 ', '2012-03-13 09:38:12', 0, 65, NULL)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 32)[0m
  [1m[35mSQL (46.3ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (32, 4)[0m
  [1m[35mSQL (46.6ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 65, NULL, 0, 'ad_party1', '2012-03-13 09:38:12', '2012-03-13 09:38:12', 'ad_party1\'s address', '123456', 0)[0m
  [1m[35mSQL (31.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:12', '2012-03-13', 2, NULL, NULL, 66, '2012-03-13 09:38:12', '2013-03-13')
  [1m[36mSQL (33.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 65, NULL, 0, 'ad_party2', '2012-03-13 09:38:12', '2012-03-13 09:38:12', 'ad_party2\'s address', '123456', 0)
  [1m[36mSQL (64.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:12', '2012-03-13', 2, NULL, NULL, 67, '2012-03-13 09:38:12', '2013-03-13')[0m
  [1m[35mSQL (85.4ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'test@test.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('d1c0f0b148c57cd5e1f61522db800982', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:12', 'test@test.com', 'test', '2012-03-13 09:38:12', 0, NULL, NULL)[0m
  [1m[35mSQL (44.9ms)[0m  COMMIT
  Processing by PartiesController#new as HTML
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 33 LIMIT 1[0m
check_result is true
Rendered parties/_f.html.erb (1.9ms)
Rendered _page_head.html.erb (1.0ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 8ms (Views: 6.8ms | ActiveRecord: 545.1ms)
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_45') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_45', '2012-03-13 09:38:12', '2012-03-13 09:38:12', 'Party_45\'s address', '123456', 0)
  [1m[36mSQL (44.1ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:12', '2012-03-13', 1, NULL, NULL, 68, '2012-03-13 09:38:12', '2013-03-13')[0m
  [1m[35mSQL (45.4ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_27 @abc.com') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('04b5631b51b68ea89c265f52f20d1392', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:12', 'member_27 @abc.com', 'member_27 ', '2012-03-13 09:38:12', 0, 68, NULL)[0m
  [1m[35mSQL (44.3ms)[0m  COMMIT
  [1m[36mRole Load (0.6ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 34)[0m
  [1m[35mSQL (46.0ms)[0m  COMMIT
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.1ms)[0m  [1mINSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (34, 4)[0m
  [1m[35mSQL (46.7ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 68, NULL, 0, 'ad_party1', '2012-03-13 09:38:12', '2012-03-13 09:38:12', 'ad_party1\'s address', '123456', 0)[0m
  [1m[35mSQL (96.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:13', '2012-03-13', 2, NULL, NULL, 69, '2012-03-13 09:38:13', '2013-03-13')
  [1m[36mSQL (183.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 68, NULL, 0, 'ad_party2', '2012-03-13 09:38:13', '2012-03-13 09:38:13', 'ad_party2\'s address', '123456', 0)
  [1m[36mSQL (43.8ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:13', '2012-03-13', 2, NULL, NULL, 70, '2012-03-13 09:38:13', '2013-03-13')[0m
  [1m[35mSQL (57.5ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'test@test.com') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('d1c0f0b148c57cd5e1f61522db800982', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:13', 'test@test.com', 'test', '2012-03-13 09:38:13', 0, NULL, NULL)[0m
  [1m[35mSQL (56.3ms)[0m  COMMIT
  Processing by PartiesController#create as HTML
  Parameters: {"party"=>{"name"=>"test", "post_code"=>"123456", "phone_number"=>"123", "party_type"=>1, "address"=>"add"}}
Geokit is using the domain: test.host
  [1m[36mMember Load (0.2ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 35 LIMIT 1[0m
check_result is true
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'test') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '123', 1, NULL, NULL, 0, 'test', '2012-03-13 09:38:13', '2012-03-13 09:38:13', 'add', '123456', 0)
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'test@test.com') AND (`members`.id <> 35) LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  UPDATE `members` SET `updated_at` = '2012-03-13 09:38:13', `party_id` = 71 WHERE `members`.`id` = 35
  [1m[36mRole Load (0.3ms)[0m  [1mSELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (35, 1)
Redirected to http://test.host/
  [1m[36mSQL (49.8ms)[0m  [1mCOMMIT[0m
Completed 302 Found in 60ms
  [1m[35mMember Load (0.3ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 35 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 71 LIMIT 1[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 35 )
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_46') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_46', '2012-03-13 09:38:13', '2012-03-13 09:38:13', 'Party_46\'s address', '123456', 0)[0m
  [1m[35mSQL (44.2ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:13', '2012-03-13', 1, NULL, NULL, 72, '2012-03-13 09:38:13', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_28 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('e33956c9f7847a27c807b4724769f7df', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:13', 'member_28 @abc.com', 'member_28 ', '2012-03-13 09:38:13', 0, 72, NULL)
  [1m[36mSQL (44.4ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (36, 1)
  [1m[36mSQL (46.4ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 36)
  [1m[36mSQL (58.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 72, NULL, 0, 'ad_party1', '2012-03-13 09:38:13', '2012-03-13 09:38:13', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (48.5ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:13', '2012-03-13', 2, NULL, NULL, 73, '2012-03-13 09:38:13', '2013-03-13')[0m
  [1m[35mSQL (56.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 72, NULL, 0, 'ad_party2', '2012-03-13 09:38:14', '2012-03-13 09:38:14', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (43.5ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:14', '2012-03-13', 2, NULL, NULL, 74, '2012-03-13 09:38:14', '2013-03-13')
  [1m[36mSQL (44.9ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1
  Processing by PartiesController#new as HTML
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 1 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )
check_result is false
Redirected to http://test.host/
Completed 302 Found in 5ms
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_47') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_47', '2012-03-13 09:38:14', '2012-03-13 09:38:14', 'Party_47\'s address', '123456', 0)[0m
  [1m[35mSQL (43.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:14', '2012-03-13', 1, NULL, NULL, 75, '2012-03-13 09:38:14', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_29 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('1861e8940635ede293490579230b5956', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:14', 'member_29 @abc.com', 'member_29 ', '2012-03-13 09:38:14', 0, 75, NULL)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 37)
  [1m[36mSQL (46.2ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`member_id`, `role_id`) VALUES (37, 4)
  [1m[36mSQL (46.6ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 75, NULL, 0, 'ad_party1', '2012-03-13 09:38:14', '2012-03-13 09:38:14', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (31.9ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:14', '2012-03-13', 2, NULL, NULL, 76, '2012-03-13 09:38:14', '2013-03-13')[0m
  [1m[35mSQL (33.1ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 75, NULL, 0, 'ad_party2', '2012-03-13 09:38:14', '2012-03-13 09:38:14', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (31.7ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:14', '2012-03-13', 2, NULL, NULL, 77, '2012-03-13 09:38:14', '2013-03-13')
  [1m[36mSQL (33.3ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 2 LIMIT 1
  Processing by PartiesController#index as HTML
Geokit is using the domain: test.host
  [1m[36mMember Load (0.1ms)[0m  [1mSELECT `members`.* FROM `members` WHERE `members`.`id` = 2 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 3 LIMIT 1
  [1m[36mParty Load (0.3ms)[0m  [1mSELECT DISTINCT `parties`.id FROM `parties` LEFT OUTER JOIN `contracts` ON `contracts`.`party_id` = `parties`.`id` WHERE ((contracts.business_type = 2) and (parties.archived = 0) and (parties.agent_id = 3)) ORDER BY parties.created_at desc LIMIT 20 OFFSET 0[0m
Rendered parties/_party.html.erb (0.0ms)
  [1m[35mSQL (0.3ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.1ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 2 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mSQL (0.1ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )
  [1m[36mSQL (0.0ms)[0m  [1mSELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 1 AND (`contracts`.party_id = 3) AND (expired_at >= '2012-03-13' )[0m
  [1m[35mAccount Load (0.2ms)[0m  SELECT `accounts`.* FROM `accounts` WHERE (`accounts`.party_id = 3) LIMIT 1
Rendered _page_head.html.erb (7.0ms)
Rendered side_bar/_agent.html.erb (0.6ms)
Rendered _page_foot.html.erb (0.1ms)
Completed 200 OK in 18ms (Views: 12.9ms | ActiveRecord: 1731.7ms)
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'Party_48') LIMIT 1
  [1m[36mAREL (0.2ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, NULL, NULL, 0, 'Party_48', '2012-03-13 09:38:14', '2012-03-13 09:38:14', 'Party_48\'s address', '123456', 0)[0m
  [1m[35mSQL (43.8ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:14', '2012-03-13', 1, NULL, NULL, 78, '2012-03-13 09:38:14', '2013-03-13')
  [1m[36mSQL (69.3ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.1ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `members` WHERE (`members`.`email` = BINARY 'member_30 @abc.com') LIMIT 1[0m
  [1m[35mAREL (0.2ms)[0m  INSERT INTO `members` (`ha1`, `password_hash`, `status`, `updated_at`, `email`, `real_name`, `created_at`, `is_admin`, `party_id`, `activation_code`) VALUES ('1bad3715cc4409122c89725d565b3970', '5f4dcc3b5aa765d61d8327deb882cf99', 1, '2012-03-13 09:38:14', 'member_30 @abc.com', 'member_30 ', '2012-03-13 09:38:14', 0, 78, NULL)
  [1m[36mSQL (199.8ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'admin' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (1, 38)
  [1m[36mSQL (58.3ms)[0m  [1mCOMMIT[0m
  [1m[35mRole Load (0.2ms)[0m  SELECT `roles`.* FROM `roles` WHERE `roles`.`code` = 'agent' LIMIT 1
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.1ms)[0m  INSERT INTO `members_roles` (`role_id`, `member_id`) VALUES (4, 38)
  [1m[36mSQL (58.7ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mSQL (0.2ms)[0m  [1mSELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party1') LIMIT 1[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (0, '12345678', 0, 78, NULL, 0, 'ad_party1', '2012-03-13 09:38:15', '2012-03-13 09:38:15', 'ad_party1\'s address', '123456', 0)
  [1m[36mSQL (44.0ms)[0m  [1mCOMMIT[0m
  [1m[35mSQL (0.0ms)[0m  BEGIN
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:15', '2012-03-13', 2, NULL, NULL, 79, '2012-03-13 09:38:15', '2013-03-13')[0m
  [1m[35mSQL (45.2ms)[0m  COMMIT
  [1m[36mSQL (0.0ms)[0m  [1mBEGIN[0m
  [1m[35mSQL (0.2ms)[0m  SELECT 1 FROM `parties` WHERE (`parties`.`name` = BINARY 'ad_party2') LIMIT 1
  [1m[36mAREL (0.1ms)[0m  [1mINSERT INTO `parties` (`archived`, `phone_number`, `party_type`, `agent_id`, `sales_id`, `adhub_operator`, `name`, `updated_at`, `created_at`, `address`, `post_code`, `ad_maintained_by`) VALUES (1, '12345678', 0, 78, NULL, 0, 'ad_party2', '2012-03-13 09:38:15', '2012-03-13 09:38:15', 'ad_party2\'s address', '123456', 0)[0m
  [1m[35mSQL (43.9ms)[0m  COMMIT
  [1m[36mSQL (0.1ms)[0m  [1mBEGIN[0m
  [1m[35mAREL (0.1ms)[0m  INSERT INTO `contracts` (`mobile_phone`, `expiration_processed`, `contact_person`, `created_at`, `start_from`, `business_type`, `share_rate_1`, `share_rate_2`, `party_id`, `updated_at`, `expired_at`) VALUES ('123456', 0, 'person', '2012-03-13 09:38:15', '2012-03-13', 2, NULL, NULL, 80, '2012-03-13 09:38:15', '2013-03-13')
  [1m[36mSQL (45.2ms)[0m  [1mCOMMIT[0m
  [1m[35mMember Load (0.2ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1
  [1m[36mParty Load (0.1ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  Processing by PartiesController#edit as HTML
  Parameters: {"id"=>#<Party id: 4, agent_id: nil, party_type: nil, adhub_operator: false, name: "Agent", address: nil, phone_number: nil, post_code: nil, created_at: "2012-03-13 09:38:14", updated_at: "2012-03-13 09:38:14", sales_id: nil, ad_maintained_by: 0, archived: false>}
Geokit is using the domain: test.host
  [1m[35mMember Load (0.1ms)[0m  SELECT `members`.* FROM `members` WHERE `members`.`id` = 1 LIMIT 1
  [1m[36mParty Load (0.0ms)[0m  [1mSELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 4 LIMIT 1[0m
  [1m[35mParty Load (0.2ms)[0m  SELECT `parties`.* FROM `parties` WHERE `parties`.`id` = 2 LIMIT 1
  [1m[36mRole Load (0.2ms)[0m  [1mSELECT * FROM `roles` INNER JOIN `members_roles` ON `roles`.id = `members_roles`.role_id WHERE (`members_roles`.member_id = 1 )[0m
  [1m[35mSQL (0.2ms)[0m  SELECT COUNT(*) FROM `contracts` WHERE `contracts`.`business_type` = 0 AND (`contracts`.party_id = 2) AND (expired_at >= '2012-03-13' )
check_result is false
Redirected to http://test.host/
Completed 302 Found in 5ms
